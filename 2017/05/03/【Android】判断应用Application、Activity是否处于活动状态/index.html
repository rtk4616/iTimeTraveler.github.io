<!doctype html>
<html lang="en">
    <head>
		
        <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content="Someone knock at the door.">
        <link rel="shortcut icon" href="/gallery/avatar/0.svg"/>
        <link rel="canonical" href="http://guolinn.com/">
        <link rel="alternate" type="application/rss+xml" title="Mr.Seven" href="/atom.xml">
        <title>【Android】判断应用Application、Activity是否处于活动状态 | iTimeTraveler</title>
        <meta name="description" content="{{meta_description}}">

        <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="/styles/crisp.css">
        <meta name="HandheldFriendly" content="True" />
        <meta name="MobileOptimized" content="320" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

    </head>
    
		<body class="post-template">
	

        <header id="header">
            <a id="logo" href="/"><img src="/gallery/avatar/0.svg" alt="iTimeTraveler" /></a>
            <h1><a href="/">Mr.Seven</a></h1>
            <p></p>
            <div id="follow-icons">
                  <a href="/atom.xml"><i class="fa fa-rss-square fa-2x"></i></a>
  </div>
<h6><a href="/about">About</a></h6>
        </header>

        <main id="content">
        

<article class="post">
  五月 3, 2017
  
    <span class="taglist">  &middot; 
    
    
      <a href='/tags/Android/'>Android</a> 
    
    </span>
  

  <h1 class="post-title">【Android】判断应用Application、Activity是否处于活动状态</h1>
  <section class="post-content article-entry">
    <p>通过<strong><code>ActivityManager</code></strong>我们可以获得系统里正在运行的activities，包括进程(Process)等、应用程序/包、服务(Service)、任务(Task)信息。</p>
<h2 id="1、判断应用App是否活动"><a href="#1、判断应用App是否活动" class="headerlink" title="1、判断应用App是否活动"></a><strong>1、判断应用App是否活动</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断应用是否已经启动</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> context 一个context</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> packageName 要判断应用的包名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> boolean</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isAppAlive</span><span class="params">(Context context, String packageName)</span></span>&#123;</span><br><span class="line">   ActivityManager activityManager =</span><br><span class="line">           (ActivityManager)context.getSystemService(Context.ACTIVITY_SERVICE);</span><br><span class="line">   List&lt;ActivityManager.RunningAppProcessInfo&gt; processInfos</span><br><span class="line">           = activityManager.getRunningAppProcesses();</span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; processInfos.size(); i++)&#123;</span><br><span class="line">       <span class="keyword">if</span>(processInfos.get(i).processName.equals(packageName))&#123;</span><br><span class="line">           Log.i(<span class="string">"NotificationLaunch"</span>,</span><br><span class="line">                   String.format(<span class="string">"the %s is running, isAppAlive return true"</span>, packageName));</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   Log.i(<span class="string">"NotificationLaunch"</span>,</span><br><span class="line">           String.format(<span class="string">"the %s is not running, isAppAlive return false"</span>, packageName));</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h2 id="2、判断Activity是否活动"><a href="#2、判断Activity是否活动" class="headerlink" title="2、判断Activity是否活动"></a><strong>2、判断Activity是否活动</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断MainActivity是否活动</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> context 一个context</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> activityName 要判断Activity</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> boolean</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isMainActivityAlive</span><span class="params">(Context context, String activityName)</span></span>&#123;</span><br><span class="line">   ActivityManager am = (ActivityManager)context.getSystemService(Context.ACTIVITY_SERVICE);</span><br><span class="line">   List&lt;ActivityManager.RunningTaskInfo&gt; list = am.getRunningTasks(<span class="number">100</span>);</span><br><span class="line">   <span class="keyword">for</span> (ActivityManager.RunningTaskInfo info : list) &#123;</span><br><span class="line">       <span class="comment">// 注意这里的 topActivity 包含 packageName和className，可以打印出来看看</span></span><br><span class="line">       <span class="keyword">if</span> (info.topActivity.toString().equals(activityName) || info.baseActivity.toString().equals(activityName)) &#123;</span><br><span class="line">           Log.i(TAG,info.topActivity.getPackageName() + <span class="string">" info.baseActivity.getPackageName()="</span>+info.baseActivity.getPackageName());</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3、Activity是否显示在前台"><a href="#3、Activity是否显示在前台" class="headerlink" title="3、Activity是否显示在前台"></a><strong>3、Activity是否显示在前台</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 检测某Activity是否在当前Task的栈顶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isTopActivity</span><span class="params">(String activityName)</span></span>&#123;</span><br><span class="line">	ActivityManager manager = (ActivityManager) mContext.getSystemService(ACTIVITY_SERVICE);</span><br><span class="line">	List&lt;ActivityManager.RunningTaskInfo&gt; runningTaskInfos = manager.getRunningTasks(<span class="number">1</span>);</span><br><span class="line">	String cmpNameTemp = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">if</span>(runningTaskInfos != <span class="keyword">null</span>)&#123;</span><br><span class="line">		cmpNameTemp = runningTaskInfos.get(<span class="number">0</span>).topActivity.toString();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(cmpNameTemp == <span class="keyword">null</span>)&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> cmpNameTemp.equals(activityName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4、Service是否在运行"><a href="#4、Service是否在运行" class="headerlink" title="4、Service是否在运行"></a><strong>4、Service是否在运行</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 用来判断服务是否运行.  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> context  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> className 判断的服务名字  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> true 在运行 false 不在运行  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isServiceRunning</span><span class="params">(Context mContext,String className)</span> </span>&#123;   </span><br><span class="line">    <span class="keyword">boolean</span> isRunning = <span class="keyword">false</span>;   </span><br><span class="line">    ActivityManager activityManager = (ActivityManager)   </span><br><span class="line">                                 mContext.getSystemService(Context.ACTIVITY_SERVICE);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//此处只在前30个中查找，大家根据需要调整</span></span><br><span class="line">    List&lt;ActivityManager.RunningServiceInfo&gt; serviceList = activityManager.getRunningServices(<span class="number">30</span>);   </span><br><span class="line">    <span class="keyword">if</span> (!(serviceList.size()&gt;<span class="number">0</span>)) &#123;   </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;   </span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;serviceList.size(); i++) &#123;   </span><br><span class="line">        <span class="keyword">if</span> (serviceList.get(i).service.getClassName().equals(className) == <span class="keyword">true</span>) &#123;   </span><br><span class="line">            isRunning = <span class="keyword">true</span>;   </span><br><span class="line">            <span class="keyword">break</span>;   </span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="keyword">return</span> isRunning;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p>1、<a href="http://blog.csdn.net/hp910315/article/details/49908203" target="_blank" rel="noopener">Android中ActivityManager的使用案例</a><br>2、<a href="https://github.com/slimhippo/androidcode/blob/master/NotificationLaunch/app/src/main/java/com/liangzili/notificationlaunch/SystemUtils.java">Android实现点击通知栏后，先启动应用再打开目标Activity的一个小demo</a><br>3、<a href="https://my.oschina.net/ososchina/blog/350498" target="_blank" rel="noopener">Android ActivityManager 检测Service与Activity是否正在运行</a></p>

  </section>
  <footer class="post-footer">
    <!--
    <section class="author">
      <h4>Mr.Seven</h4>
      <p></p>
    </section>
    -->
  </footer>
</article>

<nav class="pagination" role="pagination">
    
    <a class="newer-posts" href="../../05/Google 面试题 - 判断字符串是否可由重复子字符串组成/">
        ← prev <!--Google 面试题 | 判断字符串是否可由重复子字符串组成-->
    </a>
    
    <span class="page-number">•</span>
    
    <a class="older-posts" href="../../../04/20/【Android】使用UncaughtExceptionHandler捕获全局异常/">
        <!--【Android】使用UncaughtExceptionHandler捕获全局异常--> next →
    </a>
    
</nav>
<div id="comments">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
      var disqus_shortname = 'iTimeTraveler';
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">Comments powered by <span class="logo-disqus">Disqus</span></a>
</div>


        </main>
        <footer id="footer">
            <section id="footer-message">&copy; 2018 Mr.Seven. All rights reserved. Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. <a href="https://github.com/guolin/crisp-hexo-theme" target="_blank">crisp</a> theme by <a href="guolin.github.io" target="_blank">Guo Lin</a>.</section>
        </footer>
    </body>
</html>


