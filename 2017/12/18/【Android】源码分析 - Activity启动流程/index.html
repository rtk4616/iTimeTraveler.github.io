<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">

  <!-- PACE Progress Bar START -->
  
    <script src="../../../../js/pace.min.js"></script>
    <link rel="stylesheet" href="https://github.com/HubSpot/pace/raw/master/themes/orange/pace-theme-flash.css">
  
  

  <!-- PACE Progress Bar START -->

  
  <title>ã€androidã€‘æºç åˆ†æ - activityå¯åŠ¨æµç¨‹ | iTimeTraveler</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="Activityå¯åŠ¨æµç¨‹" />
  
  
  
  
  <meta name="description" content="å¯åŠ¨Activityçš„æ–¹å¼Activityæœ‰2ç§å¯åŠ¨çš„æ–¹å¼ï¼Œä¸€ç§æ˜¯åœ¨Launcherç•Œé¢ç‚¹å‡»åº”ç”¨çš„å›¾æ ‡ã€å¦ä¸€ç§æ˜¯åœ¨åº”ç”¨ä¸­é€šè¿‡Intentè¿›è¡Œè·³è½¬ã€‚æˆ‘ä»¬ä¸»è¦ä»‹ç»ä¸åè€…ç›¸å…³çš„å¯åŠ¨æµç¨‹ã€‚
Intent intent = new Intent(this, TestActivity.class);startActivity(intent);
ä»Activityå…¥æ‰‹@Overridepublic void s">
<meta property="og:type" content="article">
<meta property="og:title" content="ã€Androidã€‘æºç åˆ†æ - Activityå¯åŠ¨æµç¨‹">
<meta property="og:url" content="http://github.com/2017/12/18/ã€Androidã€‘æºç åˆ†æ - Activityå¯åŠ¨æµç¨‹/index.html">
<meta property="og:site_name" content="iTimeTraveler">
<meta property="og:description" content="å¯åŠ¨Activityçš„æ–¹å¼Activityæœ‰2ç§å¯åŠ¨çš„æ–¹å¼ï¼Œä¸€ç§æ˜¯åœ¨Launcherç•Œé¢ç‚¹å‡»åº”ç”¨çš„å›¾æ ‡ã€å¦ä¸€ç§æ˜¯åœ¨åº”ç”¨ä¸­é€šè¿‡Intentè¿›è¡Œè·³è½¬ã€‚æˆ‘ä»¬ä¸»è¦ä»‹ç»ä¸åè€…ç›¸å…³çš„å¯åŠ¨æµç¨‹ã€‚
Intent intent = new Intent(this, TestActivity.class);startActivity(intent);
ä»Activityå…¥æ‰‹@Overridepublic void s">
<meta property="og:image" content="http://github.com/gallery/android_common/flow.jpg">
<meta property="og:updated_time" content="2017-12-25T01:37:20.733Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ã€Androidã€‘æºç åˆ†æ - Activityå¯åŠ¨æµç¨‹">
<meta name="twitter:description" content="å¯åŠ¨Activityçš„æ–¹å¼Activityæœ‰2ç§å¯åŠ¨çš„æ–¹å¼ï¼Œä¸€ç§æ˜¯åœ¨Launcherç•Œé¢ç‚¹å‡»åº”ç”¨çš„å›¾æ ‡ã€å¦ä¸€ç§æ˜¯åœ¨åº”ç”¨ä¸­é€šè¿‡Intentè¿›è¡Œè·³è½¬ã€‚æˆ‘ä»¬ä¸»è¦ä»‹ç»ä¸åè€…ç›¸å…³çš„å¯åŠ¨æµç¨‹ã€‚
Intent intent = new Intent(this, TestActivity.class);startActivity(intent);
ä»Activityå…¥æ‰‹@Overridepublic void s">
<meta name="twitter:image" content="http://github.com/gallery/android_common/flow.jpg">
  
    <link rel="alternate" href="/atom.xml" title="iTimeTraveler" type="application/atom+xml">
  
  <link rel="icon" href="/css/images/favicon.ico">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="../../../../css/style.css">

  <script src="../../../../js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >
  <link rel="stylesheet" href="/css/hiero.css" >
  <link rel="stylesheet" href="/css/glyphs.css" >
  
    <link rel="stylesheet" href="/css/vdonate.css" >
  

  <!-- Custom CSS -->
  <link rel="stylesheet" href="../../../../css/my.css">

</head>

<script>
var themeMenus = {};

  themeMenus[""] = "é¦–é¡µ"; 

  themeMenus["../archives"] = "å½’æ¡£"; 

  themeMenus["../categories"] = "åˆ†ç±»"; 

  themeMenus["../tags"] = "æ ‡ç­¾"; 

  themeMenus["../funnysite"] = "é…·ç«™"; 

  themeMenus["../collection"] = "æ”¶è—"; 

  themeMenus["../about"] = "å…³äº"; 

  themeMenus["mybooks"] = "ğŸ"; 

</script>


  <body data-spy="scroll" data-target="#toc" data-offset="50">


  <header id="allheader" class="site-header" role="banner">
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/" title="iTimeTraveler" rel="home"> iTimeTraveler </a>
            
          </h1>

          
            <div class="site-description">Someone knock at the door.</div>
          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>
            <div class="clearfix sf-menu">

              <ul id="main-nav" class="nmenu sf-js-enabled">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="../../../../index.html">é¦–é¡µ</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="../../../../archives">å½’æ¡£</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="../../../../categories">åˆ†ç±»</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="../../../../tags">æ ‡ç­¾</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="../../../../funnysite">é…·ç«™</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="../../../../collection">æ”¶è—</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="../../../../about">å…³äº</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="../../../../mybooks">ğŸ</a> </li>
                    
              </ul>
            </div>
          </nav>


      </div>
  </div>
</header>


  <div id="originBgDiv" style="background: #fff; width: 100%;">

      <div style="max-height:600px; overflow: hidden;  display: flex; display: -webkit-flex; align-items: center;">
        <img id="originBg" width="100%" alt="" src="">
      </div>

  </div>

  <script>
  function setAboutIMG(){
      var imgUrls = "https://source.unsplash.com/collection/954550/1920x1080,gallery/bg/01.jpg,gallery/bg/02.jpg,gallery/bg/03.jpg,gallery/bg/04.jpg,gallery/bg/05.jpg,gallery/bg/06.jpg,gallery/bg/07.jpg,gallery/bg/08.jpg,gallery/bg/09.jpg,gallery/bg/10.jpg,gallery/bg/11.jpg,gallery/bg/12.jpg".split(",");
      var random = Math.floor((Math.random() * imgUrls.length ));
      if (imgUrls[random].startsWith('http') || imgUrls[random].indexOf('://') >= 0) {
        document.getElementById("originBg").src=imgUrls[random];
      } else {
        document.getElementById("originBg").src='/' + imgUrls[random];
      }
  }
  bgDiv=document.getElementById("originBgDiv");
  if(location.pathname.match('about')){
    setAboutIMG();
    bgDiv.style.display='block';
  }else{
    bgDiv.style.display='none';
  }
  </script>



  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-ã€Androidã€‘æºç åˆ†æ - Activityå¯åŠ¨æµç¨‹" style="width: 66%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="../../../../gallery/android_common/flow.jpg" rel="gallery_cjbm5r67400an5cmyj7idvlz9">
        <img src="../../../../gallery/android_common/flow.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      ã€Androidã€‘æºç åˆ†æ - Activityå¯åŠ¨æµç¨‹
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="" class="article-date">
	  <time datetime="2017-12-18T14:20:55.000Z" itemprop="datePublished">åäºŒæœˆ 18, 2017</time>
	</a>

      
	<span id="busuanzi_container_page_pv">
	  æœ¬æ–‡æ€»é˜…è¯»é‡<span id="busuanzi_value_page_pv"></span>æ¬¡
	</span>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="å¯åŠ¨Activityçš„æ–¹å¼"><a href="#å¯åŠ¨Activityçš„æ–¹å¼" class="headerlink" title="å¯åŠ¨Activityçš„æ–¹å¼"></a>å¯åŠ¨Activityçš„æ–¹å¼</h3><p>Activityæœ‰2ç§å¯åŠ¨çš„æ–¹å¼ï¼Œä¸€ç§æ˜¯åœ¨Launcherç•Œé¢ç‚¹å‡»åº”ç”¨çš„å›¾æ ‡ã€å¦ä¸€ç§æ˜¯åœ¨åº”ç”¨ä¸­é€šè¿‡Intentè¿›è¡Œè·³è½¬ã€‚æˆ‘ä»¬ä¸»è¦ä»‹ç»ä¸åè€…ç›¸å…³çš„å¯åŠ¨æµç¨‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, TestActivity.class);</div><div class="line">startActivity(intent);</div></pre></td></tr></table></figure>
<h3 id="ä»Activityå…¥æ‰‹"><a href="#ä»Activityå…¥æ‰‹" class="headerlink" title="ä»Activityå…¥æ‰‹"></a>ä»Activityå…¥æ‰‹</h3><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startActivity</span><span class="params">(Intent intent)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.startActivity(intent, <span class="keyword">null</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startActivity</span><span class="params">(Intent intent, @Nullable Bundle options)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (options != <span class="keyword">null</span>) &#123;</div><div class="line">        startActivityForResult(intent, -<span class="number">1</span>, options);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// Note we want to go through this call for compatibility with</span></div><div class="line">        <span class="comment">// applications that may have overridden the method.</span></div><div class="line">        startActivityForResult(intent, -<span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<a id="more"></a>
<p>æˆ‘ä»¬çœ‹åˆ°æœ€ç»ˆéƒ½ä¼šè¿›å…¥<code>startActivityForResult()</code>æ–¹æ³•ã€‚æˆ‘ä»¬è·Ÿè¿›å»çœ‹çœ‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startActivityForResult</span><span class="params">(Intent intent, <span class="keyword">int</span> requestCode, @Nullable Bundle options)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (mParent == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="comment">//è½¬äº¤ç»™Instrumentationæ¥startActivity</span></div><div class="line">        Instrumentation.ActivityResult ar = mInstrumentation.execStartActivity(</div><div class="line">                <span class="keyword">this</span>, mMainThread.getApplicationThread(), mToken, <span class="keyword">this</span>,</div><div class="line">                intent, requestCode, options);</div><div class="line">        <span class="keyword">if</span> (ar != <span class="keyword">null</span>) &#123;</div><div class="line">            mMainThread.sendActivityResult(</div><div class="line">                mToken, mEmbeddedID, requestCode, ar.getResultCode(),</div><div class="line">                ar.getResultData());</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (requestCode &gt;= <span class="number">0</span>) &#123;</div><div class="line">            <span class="comment">// If this start is requesting a result, we can avoid making</span></div><div class="line">            <span class="comment">// the activity visible until the result is received.  Setting</span></div><div class="line">            <span class="comment">// this code during onCreate(Bundle savedInstanceState) or onResume() will keep the</span></div><div class="line">            <span class="comment">// activity hidden during this time, to avoid flickering.</span></div><div class="line">            <span class="comment">// This can only be done when a result is requested because</span></div><div class="line">            <span class="comment">// that guarantees we will get information back when the</span></div><div class="line">            <span class="comment">// activity is finished, no matter what happens to it.</span></div><div class="line">            mStartedActivity = <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">final</span> View decor = mWindow != <span class="keyword">null</span> ? mWindow.peekDecorView() : <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">if</span> (decor != <span class="keyword">null</span>) &#123;</div><div class="line">            decor.cancelPendingInputEvents();</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// TODO Consider clearing/flushing other event sources and events for child windows.</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">if</span> (options != <span class="keyword">null</span>) &#123;</div><div class="line">            mParent.startActivityFromChild(<span class="keyword">this</span>, intent, requestCode, options);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">// Note we want to go through this method for compatibility with</span></div><div class="line">            <span class="comment">// existing applications that may have overridden it.</span></div><div class="line">            mParent.startActivityFromChild(<span class="keyword">this</span>, intent, requestCode);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (options != <span class="keyword">null</span> &amp;&amp; !isTopOfTask()) &#123;</div><div class="line">        mActivityTransitionState.startExitOutTransition(<span class="keyword">this</span>, options);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç»§ç»­è¿›å…¥<code>Instrumentation</code>ç±»ï¼Œçœ‹çœ‹<code>execStartActivity</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">//Instrumentationç±»</span></div><div class="line"><span class="function"><span class="keyword">public</span> ActivityResult <span class="title">execStartActivity</span><span class="params">(</span></span></div><div class="line">            Context who, IBinder contextThread, IBinder token, Activity target,</div><div class="line">            Intent intent, <span class="keyword">int</span> requestCode, Bundle options) &#123;</div><div class="line">    IApplicationThread whoThread = (IApplicationThread) contextThread;</div><div class="line">    <span class="keyword">if</span> (mActivityMonitors != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">synchronized</span> (mSync) &#123;</div><div class="line">            <span class="keyword">final</span> <span class="keyword">int</span> N = mActivityMonitors.size();</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N; i++) &#123;</div><div class="line">                <span class="keyword">final</span> ActivityMonitor am = mActivityMonitors.get(i);</div><div class="line">                <span class="keyword">if</span> (am.match(who, <span class="keyword">null</span>, intent)) &#123;</div><div class="line">                    am.mHits++;</div><div class="line">                    <span class="keyword">if</span> (am.isBlocking()) &#123;</div><div class="line">                        <span class="keyword">return</span> requestCode &gt;= <span class="number">0</span> ? am.getResult() : <span class="keyword">null</span>;</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        intent.migrateExtraStreamToClipData();</div><div class="line">        intent.prepareToLeaveProcess();</div><div class="line">        <span class="comment">//äº¤ç»™ActivityManagerNativeæ¥startActivity</span></div><div class="line">        <span class="keyword">int</span> result = ActivityManagerNative.getDefault()</div><div class="line">            .startActivity(whoThread, who.getBasePackageName(), intent,</div><div class="line">                    intent.resolveTypeIfNeeded(who.getContentResolver()),</div><div class="line">                    token, target != <span class="keyword">null</span> ? target.mEmbeddedID : <span class="keyword">null</span>,</div><div class="line">                    requestCode, <span class="number">0</span>, <span class="keyword">null</span>, options);</div><div class="line">        <span class="comment">//æ£€æŸ¥å¯åŠ¨Activityçš„ç»“æœ</span></div><div class="line">        checkStartActivityResult(result, intent);</div><div class="line">    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå¯åŠ¨ActivityçœŸæ­£çš„å®ç°äº¤ç»™äº†<code>ActivityManagerNative.getDefault()</code>çš„startActivityæ–¹æ³•æ¥å®Œæˆã€‚ç„¶åå¯åŠ¨ä¹‹åé€šè¿‡<code>checkStartActivityResult(result, intent);</code>æ¥æ£€æŸ¥Activityçš„å¯åŠ¨ç»“æœï¼ˆæ¯”å¦‚Activityæ²¡æœ‰åœ¨AndroidManifest.xmlä¸­æ³¨å†Œå°±throw <code>ActivityNotFoundException</code>çš„å¼‚å¸¸ç­‰ï¼‰ã€‚</p>
<p>æˆ‘ä»¬æ¥ç€é‡çœ‹ä¸‹è¿™ä¸ª<code>ActivityManagerNative</code>ã€‚</p>
<h3 id="ActivityManagerNativeæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ActivityManagerNativeæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ActivityManagerNativeæ˜¯ä»€ä¹ˆï¼Ÿ"></a>ActivityManagerNativeæ˜¯ä»€ä¹ˆï¼Ÿ</h3><p><code>ActivityManagerNative</code>æ¯”è¾ƒç‰¹æ®Šï¼Œä»ä¸‹é¢çš„å®šä¹‰å¯ä»¥çœ‹åˆ°å®ƒå°±æ˜¯ä¸€ä¸ªBinderå¯¹è±¡ï¼Œå¹¶å®ç°äº†<code>IActivityManager</code>æ¥å£ã€‚è€Œå®ƒçš„<code>getDefault()</code>æ–¹æ³•å…¶å®å°±æ˜¯é€šè¿‡<code>asInterface(IBinder obj)</code>æ–¹æ³•æ„å»ºçš„<code>ActivityManagerProxy(obj)</code>å•ä¾‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ActivityManagerNative</span> <span class="keyword">extends</span> <span class="title">Binder</span> <span class="keyword">implements</span> <span class="title">IActivityManager</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Cast a Binder object into an activity manager interface, generating</div><div class="line">     * a proxy if needed.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">public</span> IActivityManager <span class="title">asInterface</span><span class="params">(IBinder obj)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (obj == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">        IActivityManager in =</div><div class="line">            (IActivityManager)obj.queryLocalInterface(descriptor);</div><div class="line">        <span class="keyword">if</span> (in != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">return</span> in;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ActivityManagerProxy(obj);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Retrieve the system's default/global activity manager.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">public</span> IActivityManager <span class="title">getDefault</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> gDefault.get();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton&lt;IActivityManager&gt; gDefault = <span class="keyword">new</span> Singleton&lt;IActivityManager&gt;() &#123;</div><div class="line">        <span class="function"><span class="keyword">protected</span> IActivityManager <span class="title">create</span><span class="params">()</span> </span>&#123;</div><div class="line">            IBinder b = ServiceManager.getService(<span class="string">"activity"</span>);</div><div class="line">            <span class="keyword">if</span> (<span class="keyword">false</span>) &#123;</div><div class="line">                Log.v(<span class="string">"ActivityManager"</span>, <span class="string">"default service binder = "</span> + b);</div><div class="line">            &#125;</div><div class="line">            IActivityManager am = asInterface(b);</div><div class="line">            <span class="keyword">if</span> (<span class="keyword">false</span>) &#123;</div><div class="line">                Log.v(<span class="string">"ActivityManager"</span>, <span class="string">"default service = "</span> + am);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> am;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    </div><div class="line">    <span class="comment">//...çœç•¥å…¶ä»–ä»£ç ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è€Œ<code>ActivityManagerNative.getDefault()</code>å®é™…ä¸Šæ˜¯ä¸ª<code>ActivityManagerService</code>ï¼ˆç®€ç§°AMSï¼‰ï¼Œå› æ­¤Activityçš„å¯åŠ¨ä»»åŠ¡å…¶å®æœ€åäº¤ç»™äº†AMSä¸­ï¼Œ</p>
<h3 id="ActivityManagerServiceï¼ˆAMSï¼‰"><a href="#ActivityManagerServiceï¼ˆAMSï¼‰" class="headerlink" title="ActivityManagerServiceï¼ˆAMSï¼‰"></a>ActivityManagerServiceï¼ˆAMSï¼‰</h3><p>çœ‹AMSçš„<code>startActivity()</code>æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">//ActivityManagerServiceç±»</span></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">startActivity</span><span class="params">(IApplicationThread caller, String callingPackage,</span></span></div><div class="line">        Intent intent, String resolvedType, IBinder resultTo, String resultWho, <span class="keyword">int</span> requestCode,</div><div class="line">        <span class="keyword">int</span> startFlags, ProfilerInfo profilerInfo, Bundle options) &#123;</div><div class="line">    <span class="comment">//äº¤ç»™startActivityAsUseræ–¹æ³•</span></div><div class="line">    <span class="keyword">return</span> startActivityAsUser(caller, callingPackage, intent, resolvedType, resultTo,</div><div class="line">        resultWho, requestCode, startFlags, profilerInfo, options,</div><div class="line">        UserHandle.getCallingUserId());</div><div class="line">&#125;</div><div class="line"></div><div class="line"> <span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">startActivityAsUser</span><span class="params">(IApplicationThread caller, String callingPackage,</span></span></div><div class="line">        Intent intent, String resolvedType, IBinder resultTo, String resultWho, <span class="keyword">int</span> requestCode,</div><div class="line">        <span class="keyword">int</span> startFlags, ProfilerInfo profilerInfo, Bundle options, <span class="keyword">int</span> userId) &#123;</div><div class="line">    enforceNotIsolatedCaller(<span class="string">"startActivity"</span>);</div><div class="line">    userId = handleIncomingUser(Binder.getCallingPid(), Binder.getCallingUid(), userId,</div><div class="line">            <span class="keyword">false</span>, ALLOW_FULL_ONLY, <span class="string">"startActivity"</span>, <span class="keyword">null</span>);</div><div class="line">    <span class="comment">// <span class="doctag">TODO:</span> Switch to user app stacks here.</span></div><div class="line">    <span class="keyword">return</span> mStackSupervisor.startActivityMayWait(caller, -<span class="number">1</span>, callingPackage, intent,</div><div class="line">            resolvedType, <span class="keyword">null</span>, <span class="keyword">null</span>, resultTo, resultWho, requestCode, startFlags,</div><div class="line">            profilerInfo, <span class="keyword">null</span>, <span class="keyword">null</span>, options, <span class="keyword">false</span>, userId, <span class="keyword">null</span>, <span class="keyword">null</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/** mStackSupervisorçš„å®šä¹‰ Run all ActivityStacks through this */</span></div><div class="line">ActivityStackSupervisor mStackSupervisor;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡ºï¼ŒActivityå¯åŠ¨ä»»åŠ¡è¢«AMSè½¬äº¤ç»™äº†<code>ActivityStackSupervisor</code>çš„<code>startActivityMayWait</code>æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">//ActivityStackSupervisorç±»</span></div><div class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">int</span> <span class="title">startActivityMayWait</span><span class="params">(IApplicationThread caller, <span class="keyword">int</span> callingUid,</span></span></div><div class="line">        String callingPackage, Intent intent, String resolvedType,</div><div class="line">        IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor,</div><div class="line">        IBinder resultTo, String resultWho, <span class="keyword">int</span> requestCode, <span class="keyword">int</span> startFlags,</div><div class="line">        ProfilerInfo profilerInfo, WaitResult outResult, Configuration config,</div><div class="line">        Bundle options, <span class="keyword">boolean</span> ignoreTargetSecurity, <span class="keyword">int</span> userId,</div><div class="line">        IActivityContainer iContainer, TaskRecord inTask) &#123;</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">//...çœç•¥ä¸€å¤§ç‰‡ä»£ç ...</span></div><div class="line"></div><div class="line">        <span class="keyword">int</span> res = startActivityLocked(caller, intent, resolvedType, aInfo,</div><div class="line">                    voiceSession, voiceInteractor, resultTo, resultWho,</div><div class="line">                    requestCode, callingPid, callingUid, callingPackage,</div><div class="line">                    realCallingPid, realCallingUid, startFlags, options, ignoreTargetSecurity,</div><div class="line">                    componentSpecified, <span class="keyword">null</span>, container, inTask);</div><div class="line"></div><div class="line">        <span class="comment">//...å†çœç•¥ä¸€å¤§ç‰‡ä»£ç ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">int</span> <span class="title">startActivityLocked</span><span class="params">(IApplicationThread caller,</span></span></div><div class="line">        Intent intent, String resolvedType, ActivityInfo aInfo,</div><div class="line">        IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor,</div><div class="line">        IBinder resultTo, String resultWho, <span class="keyword">int</span> requestCode,</div><div class="line">        <span class="keyword">int</span> callingPid, <span class="keyword">int</span> callingUid, String callingPackage,</div><div class="line">        <span class="keyword">int</span> realCallingPid, <span class="keyword">int</span> realCallingUid, <span class="keyword">int</span> startFlags, Bundle options,</div><div class="line">        <span class="keyword">boolean</span> ignoreTargetSecurity, <span class="keyword">boolean</span> componentSpecified, ActivityRecord[] outActivity,</div><div class="line">        ActivityContainer container, TaskRecord inTask) &#123;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> err = ActivityManager.START_SUCCESS;</div><div class="line">    </div><div class="line">    <span class="comment">//...å†çœç•¥ä¸€å¤§ç‰‡ä»£ç ...</span></div><div class="line"></div><div class="line">    err = startActivityUncheckedLocked(r, sourceRecord, voiceSession, voiceInteractor,</div><div class="line">            startFlags, <span class="keyword">true</span>, options, inTask);</div><div class="line">    <span class="keyword">if</span> (err &lt; <span class="number">0</span>) &#123;</div><div class="line">        <span class="comment">// If someone asked to have the keyguard dismissed on the next</span></div><div class="line">        <span class="comment">// activity start, but we are not actually doing an activity</span></div><div class="line">        <span class="comment">// switch...  just dismiss the keyguard now, because we</span></div><div class="line">        <span class="comment">// probably want to see whatever is behind it.</span></div><div class="line">        notifyActivityDrawnForKeyguard();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> err;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>ActivityStackSupervisor</code>ç±»ä¸­çš„<code>startActivityMayWait</code>æ–¹æ³•è°ƒç”¨<code>startActivityLocked()</code>ç»§ç»­æ‰§è¡Œï¼Œè€Œ<code>startActivityLocked()</code>æ–¹æ³•ä¸­åˆä¼šè°ƒç”¨<code>startActivityUncheckedLocked()</code>æ–¹æ³•ï¼Œç„¶åä¼šè°ƒç”¨<code>resumeTopActivitiesLocked()</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">//ActivityStackSupervisorç±»</span></div><div class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">resumeTopActivitiesLocked</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> resumeTopActivitiesLocked(<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">resumeTopActivitiesLocked</span><span class="params">(ActivityStack targetStack, ActivityRecord target,</span></span></div><div class="line">        Bundle targetOptions) &#123;</div><div class="line">    <span class="keyword">if</span> (targetStack == <span class="keyword">null</span>) &#123;</div><div class="line">        targetStack = mFocusedStack;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// Do targetStack first.</span></div><div class="line">    <span class="keyword">boolean</span> result = <span class="keyword">false</span>;</div><div class="line">    <span class="keyword">if</span> (isFrontStack(targetStack)) &#123;</div><div class="line">        <span class="comment">//åˆ°è¿™é‡Œï¼Œå¯åŠ¨è¿‡ç¨‹ä»ActivityStackSupervisorç±»äº¤ç»™äº†ActivityStackç±»</span></div><div class="line">        result = targetStack.resumeTopActivityLocked(target, targetOptions);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> displayNdx = mActivityDisplays.size() - <span class="number">1</span>; displayNdx &gt;= <span class="number">0</span>; --displayNdx) &#123;</div><div class="line">        <span class="keyword">final</span> ArrayList&lt;ActivityStack&gt; stacks = mActivityDisplays.valueAt(displayNdx).mStacks;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> stackNdx = stacks.size() - <span class="number">1</span>; stackNdx &gt;= <span class="number">0</span>; --stackNdx) &#123;</div><div class="line">            <span class="keyword">final</span> ActivityStack stack = stacks.get(stackNdx);</div><div class="line">            <span class="keyword">if</span> (stack == targetStack) &#123;</div><div class="line">                <span class="comment">// Already started above.</span></div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (isFrontStack(stack)) &#123;</div><div class="line">                stack.resumeTopActivityLocked(<span class="keyword">null</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç èƒ½çœ‹åˆ°ï¼Œæœ€åå¯åŠ¨è¿‡ç¨‹ä»<code>ActivityStackSupervisor</code>ç±»äº¤ç»™äº†<code>ActivityStack</code>ç±»ã€‚</p>
<p>è·Ÿè¿›å®ƒçš„<code>resumeTopActivityLocked</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Ensure that the top activity in the stack is resumed.</div><div class="line"> *</div><div class="line"> * <span class="doctag">@param</span> prev The previously resumed activity, for when in the process</div><div class="line"> * of pausing; can be null to call from elsewhere.</div><div class="line"> *</div><div class="line"> * <span class="doctag">@return</span> Returns true if something is being resumed, or false if</div><div class="line"> * nothing happened.</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">resumeTopActivityLocked</span><span class="params">(ActivityRecord prev)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> resumeTopActivityLocked(prev, <span class="keyword">null</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">resumeTopActivityLocked</span><span class="params">(ActivityRecord prev, Bundle options)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (mStackSupervisor.inResumeTopActivity) &#123;</div><div class="line">        <span class="comment">// Don't even start recursing.</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">boolean</span> result = <span class="keyword">false</span>;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        <span class="comment">// Protect against recursion.</span></div><div class="line">        mStackSupervisor.inResumeTopActivity = <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">if</span> (mService.mLockScreenShown == ActivityManagerService.LOCK_SCREEN_LEAVING) &#123;</div><div class="line">            mService.mLockScreenShown = ActivityManagerService.LOCK_SCREEN_HIDDEN;</div><div class="line">            mService.updateSleepIfNeededLocked();</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//æ³¨æ„è¿™é‡Œ</span></div><div class="line">        result = resumeTopActivityInnerLocked(prev, options);</div><div class="line">    &#125; <span class="keyword">finally</span> &#123;</div><div class="line">        mStackSupervisor.inResumeTopActivity = <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç»§ç»­çœ‹çœ‹<code>resumeTopActivityInnerLocked()</code>æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">resumeTopActivityInnerLocked</span><span class="params">(ActivityRecord prev, Bundle options)</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="comment">//çœ‹è¿™é‡Œï¼Œåˆè¿”å›äº¤ç»™äº†ActivityStackSupervisorç±»</span></div><div class="line">    mStackSupervisor.startSpecificActivityLocked(next, <span class="keyword">true</span>, <span class="keyword">false</span>);     </div><div class="line"></div><div class="line">    <span class="comment">//...çœç•¥ä¸€å¤§ç‰‡ä»£ç ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="åˆè¿”å›ActivityStackSupervisorç±»"><a href="#åˆè¿”å›ActivityStackSupervisorç±»" class="headerlink" title="åˆè¿”å›ActivityStackSupervisorç±»"></a>åˆè¿”å›ActivityStackSupervisorç±»</h3><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">//ActivityStackSupervisorç±»</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">startSpecificActivityLocked</span><span class="params">(ActivityRecord r,</span></span></div><div class="line">        <span class="keyword">boolean</span> andResume, <span class="keyword">boolean</span> checkConfig) &#123;</div><div class="line">  </div><div class="line">    <span class="comment">// Is this activity's application already running?</span></div><div class="line">    <span class="comment">// åˆ¤æ–­éœ€è¦å¯åŠ¨çš„Activityæ‰€åœ¨è¿›ç¨‹å’Œappå·²ç»å­˜åœ¨ï¼Œè‹¥å­˜åœ¨ï¼Œç›´æ¥å¯åŠ¨ï¼Œå¦åˆ™å‡†å¤‡åˆ›å»ºè¯¥è¿›ç¨‹ã€‚</span></div><div class="line">    ProcessRecord app = mService.getProcessRecordLocked(r.processName,</div><div class="line">            r.info.applicationInfo.uid, <span class="keyword">true</span>);</div><div class="line">    r.task.stack.setLaunchTime(r);</div><div class="line">    <span class="keyword">if</span> (app != <span class="keyword">null</span> &amp;&amp; app.thread != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">if</span> ((r.info.flags&amp;ActivityInfo.FLAG_MULTIPROCESS) == <span class="number">0</span></div><div class="line">                    || !<span class="string">"android"</span>.equals(r.info.packageName)) &#123;</div><div class="line">                <span class="comment">// Don't add this if it is a platform component that is marked</span></div><div class="line">                <span class="comment">// to run in multiple processes, because this is actually</span></div><div class="line">                <span class="comment">// part of the framework so doesn't make sense to track as a</span></div><div class="line">                <span class="comment">// separate apk in the process.</span></div><div class="line">                app.addPackage(r.info.packageName, r.info.applicationInfo.versionCode,</div><div class="line">                        mService.mProcessStats);</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//æ³¨æ„è¿™é‡Œ</span></div><div class="line">            realStartActivityLocked(r, app, andResume, checkConfig);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</div><div class="line">            Slog.w(TAG, <span class="string">"Exception when starting activity "</span></div><div class="line">                    + r.intent.getComponent().flattenToShortString(), e);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// If a dead object exception was thrown -- fall through to</span></div><div class="line">        <span class="comment">// restart the application.</span></div><div class="line">    &#125;</div><div class="line">    <span class="comment">// å¦åˆ™å‡†å¤‡åˆ›å»ºè¯¥è¿›ç¨‹</span></div><div class="line">    mService.startProcessLocked(r.processName, r.info.applicationInfo, <span class="keyword">true</span>, <span class="number">0</span>,</div><div class="line">            <span class="string">"activity"</span>, r.intent.getComponent(), <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">true</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„<code>startSpecificActivityLocked()</code>æ–¹æ³•ï¼Œé¦–å…ˆåˆ¤æ–­éœ€è¦å¯åŠ¨çš„Activityæ‰€åœ¨è¿›ç¨‹å’Œappæ˜¯å¦å·²ç»å­˜åœ¨ã€‚è‹¥å­˜åœ¨ï¼Œç›´æ¥æ‹¿ç€è¯¥è¿›è¡Œä¿¡æ¯å»å¯åŠ¨è¯¥Activityï¼Œå¦åˆ™å‡†å¤‡åˆ›å»ºè¯¥è¿›ç¨‹ã€‚</p>
<p>æˆ‘ä»¬ç®€å•å…ˆçœ‹ä¸‹åˆ›å»ºè¯¥Appè¿›ç¨‹çš„æ–¹æ³•<code>startProcessLocked()</code>ï¼Œä½äºActivityManagerServiceç±»ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">//ActivityManagerServiceç±»ä¸­</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">startProcessLocked</span><span class="params">(ProcessRecord app, String hostingType,</span></span></div><div class="line">        String hostingNameStr, String abiOverride, String entryPoint, String[] entryPointArgs) &#123;</div><div class="line"></div><div class="line">    <span class="keyword">long</span> startTime = SystemClock.elapsedRealtime();</div><div class="line">    <span class="keyword">if</span> (app.pid &gt; <span class="number">0</span> &amp;&amp; app.pid != MY_PID) &#123;</div><div class="line">        checkTime(startTime, <span class="string">"startProcess: removing from pids map"</span>);</div><div class="line">        <span class="keyword">synchronized</span> (mPidsSelfLocked) &#123;</div><div class="line">            mPidsSelfLocked.remove(app.pid);</div><div class="line">            mHandler.removeMessages(PROC_START_TIMEOUT_MSG, app);</div><div class="line">        &#125;</div><div class="line">        checkTime(startTime, <span class="string">"startProcess: done removing from pids map"</span>);</div><div class="line">        app.setPid(<span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (DEBUG_PROCESSES &amp;&amp; mProcessesOnHold.contains(app)) Slog.v(TAG_PROCESSES,</div><div class="line">            <span class="string">"startProcessLocked removing on hold: "</span> + app);</div><div class="line">    mProcessesOnHold.remove(app);</div><div class="line"></div><div class="line">    checkTime(startTime, <span class="string">"startProcess: starting to update cpu stats"</span>);</div><div class="line">    updateCpuStats();</div><div class="line">    checkTime(startTime, <span class="string">"startProcess: done updating cpu stats"</span>);</div><div class="line"></div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">    </div><div class="line">    	<span class="comment">//...çœç•¥å…¶ä»–ä»£ç ...</span></div><div class="line">        </div><div class="line">        <span class="comment">// Process.start()å®Œæˆäº†ActivityThreadçš„åˆ›å»ºï¼Œä¹‹åå°±ä¼šæ‰§è¡ŒActivityThreadçš„main()æ–¹æ³•</span></div><div class="line">        <span class="comment">// Start the process.  It will either succeed and return a result containing</span></div><div class="line">        <span class="comment">// the PID of the new process, or else throw a RuntimeException.</span></div><div class="line">        <span class="keyword">boolean</span> isActivityProcess = (entryPoint == <span class="keyword">null</span>);</div><div class="line">        <span class="keyword">if</span> (entryPoint == <span class="keyword">null</span>) entryPoint = <span class="string">"android.app.ActivityThread"</span>;</div><div class="line">        Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="string">"Start proc: "</span> +</div><div class="line">                    app.processName);</div><div class="line">        checkTime(startTime, <span class="string">"startProcess: asking zygote to start proc"</span>);</div><div class="line">        Process.ProcessStartResult startResult = Process.start(entryPoint,</div><div class="line">                app.processName, uid, uid, gids, debugFlags, mountExternal,</div><div class="line">                app.info.targetSdkVersion, app.info.seinfo, requiredAbi, instructionSet,</div><div class="line">                app.info.dataDir, entryPointArgs);</div><div class="line">        checkTime(startTime, <span class="string">"startProcess: returned from zygote!"</span>);</div><div class="line">        Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);</div><div class="line"></div><div class="line">        <span class="comment">//...çœç•¥å…¶ä»–ä»£ç ...</span></div><div class="line"></div><div class="line">    &#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</div><div class="line">        <span class="comment">// XXX do better error recovery.</span></div><div class="line">        app.setPid(<span class="number">0</span>);</div><div class="line">        mBatteryStatsService.noteProcessFinish(app.processName, app.info.uid);</div><div class="line">        <span class="keyword">if</span> (app.isolated) &#123;</div><div class="line">            mBatteryStatsService.removeIsolatedUid(app.uid, app.info.uid);</div><div class="line">        &#125;</div><div class="line">        Slog.e(TAG, <span class="string">"Failure starting process "</span> + app.processName, e);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•å°±æ˜¯ä½¿ç”¨<code>Process.start()</code>ï¼Œå¹¶é€šè¿‡Socketè¿æ¥çš„æ–¹å¼å­µåŒ–æ–°å»ºäº†ä¸€ä¸ª<strong>Zygoteè¿›ç¨‹</strong>ï¼Œå®Œæˆäº†ActivityThreadçš„åˆ›å»ºï¼Œä¹‹åå°±ä¼šæ‰§è¡ŒActivityThreadçš„<code>main()</code>æ–¹æ³•ã€‚</p>
<p>æ¥ç€ä¸Šé¢ï¼ŒAppè¿›ç¨‹å¦‚æœå­˜åœ¨å°±ä¼šç›´æ¥è°ƒç”¨<code>realStartActivityLocked()</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">//ActivityStackSupervisorç±»ä¸­</span></div><div class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">realStartActivityLocked</span><span class="params">(ActivityRecord r,</span></span></div><div class="line">        ProcessRecord app, <span class="keyword">boolean</span> andResume, <span class="keyword">boolean</span> checkConfig)</div><div class="line">        <span class="keyword">throws</span> RemoteException &#123;</div><div class="line"></div><div class="line">    <span class="comment">//...çœç•¥å…¶ä»–ä»£ç ...</span></div><div class="line"></div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        app.forceProcessStateUpTo(mService.mTopProcessState);</div><div class="line">        app.thread.scheduleLaunchActivity(<span class="keyword">new</span> Intent(r.intent), r.appToken,</div><div class="line">                System.identityHashCode(r), r.info, <span class="keyword">new</span> Configuration(mService.mConfiguration),</div><div class="line">                <span class="keyword">new</span> Configuration(stack.mOverrideConfig), r.compat, r.launchedFromPackage,</div><div class="line">                task.voiceInteractor, app.repProcState, r.icicle, r.persistentState, results,</div><div class="line">                newIntents, !andResume, mService.isNextTransitionForward(), profilerInfo);</div><div class="line"></div><div class="line">    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</div><div class="line">        <span class="keyword">throw</span> e;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„è°ƒç”¨äº†<code>app.thread</code>çš„<code>scheduleLaunchActivity()</code>æ–¹æ³•ï¼Œappçš„ç±»å‹æ˜¯<code>ProcessRecord</code>ç±»ï¼Œå®ƒçš„threadæˆå‘˜å˜é‡å®šä¹‰å¦‚ä¸‹ï¼Œæ˜¯ä¸€ä¸ª<code>IApplicationThread</code>å¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Full information about a particular process that</div><div class="line"> * is currently running.</div><div class="line"> */</div><div class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ProcessRecord</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = TAG_WITH_CLASS_NAME ? <span class="string">"ProcessRecord"</span> : TAG_AM;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BatteryStatsImpl mBatteryStats; <span class="comment">// where to collect runtime statistics</span></div><div class="line">    <span class="keyword">final</span> ApplicationInfo info; <span class="comment">// all about the first app in the process</span></div><div class="line">    <span class="keyword">final</span> <span class="keyword">boolean</span> isolated;     <span class="comment">// true if this is a special isolated process</span></div><div class="line">    <span class="keyword">final</span> <span class="keyword">int</span> uid;              <span class="comment">// uid of process; may be different from 'info' if isolated</span></div><div class="line">    <span class="keyword">final</span> <span class="keyword">int</span> userId;           <span class="comment">// user of process.</span></div><div class="line">    <span class="keyword">final</span> String processName;   <span class="comment">// name of the process</span></div><div class="line">    <span class="comment">// List of packages running in the process</span></div><div class="line">    <span class="keyword">final</span> ArrayMap&lt;String, ProcessStats.ProcessStateHolder&gt; pkgList = <span class="keyword">new</span> ArrayMap&lt;&gt;();</div><div class="line">    UidRecord uidRecord;        <span class="comment">// overall state of process's uid.</span></div><div class="line">    ArraySet&lt;String&gt; pkgDeps;   <span class="comment">// additional packages we have a dependency on</span></div><div class="line">    IApplicationThread thread;  <span class="comment">// the actual proc...  may be null only if</span></div><div class="line">                                <span class="comment">// 'persistent' is true (in which case we</span></div><div class="line">                                <span class="comment">// are in the process of launching the app)</span></div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">    <span class="comment">//...çœç•¥å…¶ä»–ä»£ç ...</span></div></pre></td></tr></table></figure>
<p>è€Œ<code>IApplicationThread</code>çš„å£°æ˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * System private API for communicating with the application.  This is given to</div><div class="line"> * the activity manager by an application  when it starts up, for the activity</div><div class="line"> * manager to tell the application about things it needs to do.</div><div class="line"> *</div><div class="line"> * &#123;<span class="doctag">@hide</span>&#125;</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IApplicationThread</span> <span class="keyword">extends</span> <span class="title">IInterface</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">schedulePauseActivity</span><span class="params">(IBinder token, <span class="keyword">boolean</span> finished, <span class="keyword">boolean</span> userLeaving,</span></span></div><div class="line">            <span class="keyword">int</span> configChanges, <span class="keyword">boolean</span> dontReport) <span class="keyword">throws</span> RemoteException;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleStopActivity</span><span class="params">(IBinder token, <span class="keyword">boolean</span> showWindow,</span></span></div><div class="line">            <span class="keyword">int</span> configChanges) <span class="keyword">throws</span> RemoteException;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleWindowVisibility</span><span class="params">(IBinder token, <span class="keyword">boolean</span> showWindow)</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleSleeping</span><span class="params">(IBinder token, <span class="keyword">boolean</span> sleeping)</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleResumeActivity</span><span class="params">(IBinder token, <span class="keyword">int</span> procState, <span class="keyword">boolean</span> isForward, Bundle resumeArgs)</span></span></div><div class="line">            <span class="keyword">throws</span> RemoteException;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleSendResult</span><span class="params">(IBinder token, List&lt;ResultInfo&gt; results)</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleLaunchActivity</span><span class="params">(Intent intent, IBinder token, <span class="keyword">int</span> ident,</span></span></div><div class="line">            ActivityInfo info, Configuration curConfig, Configuration overrideConfig,</div><div class="line">            CompatibilityInfo compatInfo, String referrer, IVoiceInteractor voiceInteractor,</div><div class="line">            <span class="keyword">int</span> procState, Bundle state, PersistableBundle persistentState,</div><div class="line">            List&lt;ResultInfo&gt; pendingResults, List&lt;ReferrerIntent&gt; pendingNewIntents,</div><div class="line">            <span class="keyword">boolean</span> notResumed, <span class="keyword">boolean</span> isForward, ProfilerInfo profilerInfo) <span class="keyword">throws</span> RemoteException;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleRelaunchActivity</span><span class="params">(IBinder token, List&lt;ResultInfo&gt; pendingResults,</span></span></div><div class="line">            List&lt;ReferrerIntent&gt; pendingNewIntents, <span class="keyword">int</span> configChanges, <span class="keyword">boolean</span> notResumed,</div><div class="line">            Configuration config, Configuration overrideConfig) <span class="keyword">throws</span> RemoteException;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleNewIntent</span><span class="params">(List&lt;ReferrerIntent&gt; intent, IBinder token)</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleDestroyActivity</span><span class="params">(IBinder token, <span class="keyword">boolean</span> finished,</span></span></div><div class="line">            <span class="keyword">int</span> configChanges) <span class="keyword">throws</span> RemoteException;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleReceiver</span><span class="params">(Intent intent, ActivityInfo info, CompatibilityInfo compatInfo,</span></span></div><div class="line">            <span class="keyword">int</span> resultCode, String data, Bundle extras, <span class="keyword">boolean</span> sync,</div><div class="line">            <span class="keyword">int</span> sendingUser, <span class="keyword">int</span> processState) <span class="keyword">throws</span> RemoteException;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BACKUP_MODE_INCREMENTAL = <span class="number">0</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BACKUP_MODE_FULL = <span class="number">1</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BACKUP_MODE_RESTORE = <span class="number">2</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BACKUP_MODE_RESTORE_FULL = <span class="number">3</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleCreateBackupAgent</span><span class="params">(ApplicationInfo app, CompatibilityInfo compatInfo,</span></span></div><div class="line">            <span class="keyword">int</span> backupMode) <span class="keyword">throws</span> RemoteException;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleDestroyBackupAgent</span><span class="params">(ApplicationInfo app, CompatibilityInfo compatInfo)</span></span></div><div class="line">            <span class="keyword">throws</span> RemoteException;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleCreateService</span><span class="params">(IBinder token, ServiceInfo info,</span></span></div><div class="line">            CompatibilityInfo compatInfo, <span class="keyword">int</span> processState) <span class="keyword">throws</span> RemoteException;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleBindService</span><span class="params">(IBinder token,</span></span></div><div class="line">            Intent intent, <span class="keyword">boolean</span> rebind, <span class="keyword">int</span> processState) <span class="keyword">throws</span> RemoteException;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleUnbindService</span><span class="params">(IBinder token,</span></span></div><div class="line">            Intent intent) <span class="keyword">throws</span> RemoteException;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleServiceArgs</span><span class="params">(IBinder token, <span class="keyword">boolean</span> taskRemoved, <span class="keyword">int</span> startId,</span></span></div><div class="line">            <span class="keyword">int</span> flags, Intent args) <span class="keyword">throws</span> RemoteException;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleStopService</span><span class="params">(IBinder token)</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEBUG_OFF = <span class="number">0</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEBUG_ON = <span class="number">1</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEBUG_WAIT = <span class="number">2</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">bindApplication</span><span class="params">(String packageName, ApplicationInfo info, List&lt;ProviderInfo&gt; providers,</span></span></div><div class="line">            ComponentName testName, ProfilerInfo profilerInfo, Bundle testArguments,</div><div class="line">            IInstrumentationWatcher testWatcher, IUiAutomationConnection uiAutomationConnection,</div><div class="line">            <span class="keyword">int</span> debugMode, <span class="keyword">boolean</span> openGlTrace, <span class="keyword">boolean</span> restrictedBackupMode, <span class="keyword">boolean</span> persistent,</div><div class="line">            Configuration config, CompatibilityInfo compatInfo, Map&lt;String, IBinder&gt; services,</div><div class="line">            Bundle coreSettings) <span class="keyword">throws</span> RemoteException;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleExit</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleSuicide</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleConfigurationChanged</span><span class="params">(Configuration config)</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateTimeZone</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clearDnsCache</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setHttpProxy</span><span class="params">(String proxy, String port, String exclList,</span></span></div><div class="line">            Uri pacFileUrl) <span class="keyword">throws</span> RemoteException;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">processInBackground</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dumpService</span><span class="params">(FileDescriptor fd, IBinder servicetoken, String[] args)</span></span></div><div class="line">            <span class="keyword">throws</span> RemoteException;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dumpProvider</span><span class="params">(FileDescriptor fd, IBinder servicetoken, String[] args)</span></span></div><div class="line">            <span class="keyword">throws</span> RemoteException;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleRegisteredReceiver</span><span class="params">(IIntentReceiver receiver, Intent intent,</span></span></div><div class="line">            <span class="keyword">int</span> resultCode, String data, Bundle extras, <span class="keyword">boolean</span> ordered,</div><div class="line">            <span class="keyword">boolean</span> sticky, <span class="keyword">int</span> sendingUser, <span class="keyword">int</span> processState) <span class="keyword">throws</span> RemoteException;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleLowMemory</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleActivityConfigurationChanged</span><span class="params">(IBinder token, Configuration overrideConfig)</span></span></div><div class="line">            <span class="keyword">throws</span> RemoteException;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">profilerControl</span><span class="params">(<span class="keyword">boolean</span> start, ProfilerInfo profilerInfo, <span class="keyword">int</span> profileType)</span></span></div><div class="line">            <span class="keyword">throws</span> RemoteException;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dumpHeap</span><span class="params">(<span class="keyword">boolean</span> managed, String path, ParcelFileDescriptor fd)</span></span></div><div class="line">            <span class="keyword">throws</span> RemoteException;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setSchedulingGroup</span><span class="params">(<span class="keyword">int</span> group)</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PACKAGE_REMOVED = <span class="number">0</span>;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> EXTERNAL_STORAGE_UNAVAILABLE = <span class="number">1</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dispatchPackageBroadcast</span><span class="params">(<span class="keyword">int</span> cmd, String[] packages)</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleCrash</span><span class="params">(String msg)</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dumpActivity</span><span class="params">(FileDescriptor fd, IBinder servicetoken, String prefix, String[] args)</span></span></div><div class="line">            <span class="keyword">throws</span> RemoteException;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setCoreSettings</span><span class="params">(Bundle coreSettings)</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updatePackageCompatibilityInfo</span><span class="params">(String pkg, CompatibilityInfo info)</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleTrimMemory</span><span class="params">(<span class="keyword">int</span> level)</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dumpMemInfo</span><span class="params">(FileDescriptor fd, Debug.MemoryInfo mem, <span class="keyword">boolean</span> checkin, <span class="keyword">boolean</span> dumpInfo,</span></span></div><div class="line">            <span class="keyword">boolean</span> dumpDalvik, <span class="keyword">boolean</span> dumpSummaryOnly, String[] args) <span class="keyword">throws</span> RemoteException;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dumpGfxInfo</span><span class="params">(FileDescriptor fd, String[] args)</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dumpDbInfo</span><span class="params">(FileDescriptor fd, String[] args)</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">unstableProviderDied</span><span class="params">(IBinder provider)</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">requestAssistContextExtras</span><span class="params">(IBinder activityToken, IBinder requestToken, <span class="keyword">int</span> requestType)</span></span></div><div class="line">            <span class="keyword">throws</span> RemoteException;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleTranslucentConversionComplete</span><span class="params">(IBinder token, <span class="keyword">boolean</span> timeout)</span></span></div><div class="line">            <span class="keyword">throws</span> RemoteException;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleOnNewActivityOptions</span><span class="params">(IBinder token, ActivityOptions options)</span></span></div><div class="line">            <span class="keyword">throws</span> RemoteException;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setProcessState</span><span class="params">(<span class="keyword">int</span> state)</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleInstallProvider</span><span class="params">(ProviderInfo provider)</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateTimePrefs</span><span class="params">(<span class="keyword">boolean</span> is24Hour)</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleCancelVisibleBehind</span><span class="params">(IBinder token)</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleBackgroundVisibleBehindChanged</span><span class="params">(IBinder token, <span class="keyword">boolean</span> enabled)</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">scheduleEnterAnimationComplete</span><span class="params">(IBinder token)</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">notifyCleartextNetwork</span><span class="params">(<span class="keyword">byte</span>[] firstPacket)</span> <span class="keyword">throws</span> RemoteException</span>;</div><div class="line"></div><div class="line">    String descriptor = <span class="string">"android.app.IApplicationThread"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> SCHEDULE_PAUSE_ACTIVITY_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION;</div><div class="line">    <span class="keyword">int</span> SCHEDULE_STOP_ACTIVITY_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">2</span>;</div><div class="line">    <span class="keyword">int</span> SCHEDULE_WINDOW_VISIBILITY_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">3</span>;</div><div class="line">    <span class="keyword">int</span> SCHEDULE_RESUME_ACTIVITY_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">4</span>;</div><div class="line">    <span class="keyword">int</span> SCHEDULE_SEND_RESULT_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">5</span>;</div><div class="line">    <span class="keyword">int</span> SCHEDULE_LAUNCH_ACTIVITY_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">6</span>;</div><div class="line">    <span class="keyword">int</span> SCHEDULE_NEW_INTENT_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">7</span>;</div><div class="line">    <span class="keyword">int</span> SCHEDULE_FINISH_ACTIVITY_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">8</span>;</div><div class="line">    <span class="keyword">int</span> SCHEDULE_RECEIVER_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">9</span>;</div><div class="line">    <span class="keyword">int</span> SCHEDULE_CREATE_SERVICE_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">10</span>;</div><div class="line">    <span class="keyword">int</span> SCHEDULE_STOP_SERVICE_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">11</span>;</div><div class="line">    <span class="keyword">int</span> BIND_APPLICATION_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">12</span>;</div><div class="line">    <span class="keyword">int</span> SCHEDULE_EXIT_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">13</span>;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> SCHEDULE_CONFIGURATION_CHANGED_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">15</span>;</div><div class="line">    <span class="keyword">int</span> SCHEDULE_SERVICE_ARGS_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">16</span>;</div><div class="line">    <span class="keyword">int</span> UPDATE_TIME_ZONE_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">17</span>;</div><div class="line">    <span class="keyword">int</span> PROCESS_IN_BACKGROUND_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">18</span>;</div><div class="line">    <span class="keyword">int</span> SCHEDULE_BIND_SERVICE_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">19</span>;</div><div class="line">    <span class="keyword">int</span> SCHEDULE_UNBIND_SERVICE_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">20</span>;</div><div class="line">    <span class="keyword">int</span> DUMP_SERVICE_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">21</span>;</div><div class="line">    <span class="keyword">int</span> SCHEDULE_REGISTERED_RECEIVER_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">22</span>;</div><div class="line">    <span class="keyword">int</span> SCHEDULE_LOW_MEMORY_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">23</span>;</div><div class="line">    <span class="keyword">int</span> SCHEDULE_ACTIVITY_CONFIGURATION_CHANGED_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">24</span>;</div><div class="line">    <span class="keyword">int</span> SCHEDULE_RELAUNCH_ACTIVITY_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">25</span>;</div><div class="line">    <span class="keyword">int</span> SCHEDULE_SLEEPING_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">26</span>;</div><div class="line">    <span class="keyword">int</span> PROFILER_CONTROL_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">27</span>;</div><div class="line">    <span class="keyword">int</span> SET_SCHEDULING_GROUP_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">28</span>;</div><div class="line">    <span class="keyword">int</span> SCHEDULE_CREATE_BACKUP_AGENT_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">29</span>;</div><div class="line">    <span class="keyword">int</span> SCHEDULE_DESTROY_BACKUP_AGENT_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">30</span>;</div><div class="line">    <span class="keyword">int</span> SCHEDULE_ON_NEW_ACTIVITY_OPTIONS_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">31</span>;</div><div class="line">    <span class="keyword">int</span> SCHEDULE_SUICIDE_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">32</span>;</div><div class="line">    <span class="keyword">int</span> DISPATCH_PACKAGE_BROADCAST_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">33</span>;</div><div class="line">    <span class="keyword">int</span> SCHEDULE_CRASH_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">34</span>;</div><div class="line">    <span class="keyword">int</span> DUMP_HEAP_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">35</span>;</div><div class="line">    <span class="keyword">int</span> DUMP_ACTIVITY_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">36</span>;</div><div class="line">    <span class="keyword">int</span> CLEAR_DNS_CACHE_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">37</span>;</div><div class="line">    <span class="keyword">int</span> SET_HTTP_PROXY_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">38</span>;</div><div class="line">    <span class="keyword">int</span> SET_CORE_SETTINGS_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">39</span>;</div><div class="line">    <span class="keyword">int</span> UPDATE_PACKAGE_COMPATIBILITY_INFO_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">40</span>;</div><div class="line">    <span class="keyword">int</span> SCHEDULE_TRIM_MEMORY_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">41</span>;</div><div class="line">    <span class="keyword">int</span> DUMP_MEM_INFO_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">42</span>;</div><div class="line">    <span class="keyword">int</span> DUMP_GFX_INFO_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">43</span>;</div><div class="line">    <span class="keyword">int</span> DUMP_PROVIDER_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">44</span>;</div><div class="line">    <span class="keyword">int</span> DUMP_DB_INFO_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">45</span>;</div><div class="line">    <span class="keyword">int</span> UNSTABLE_PROVIDER_DIED_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">46</span>;</div><div class="line">    <span class="keyword">int</span> REQUEST_ASSIST_CONTEXT_EXTRAS_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">47</span>;</div><div class="line">    <span class="keyword">int</span> SCHEDULE_TRANSLUCENT_CONVERSION_COMPLETE_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">48</span>;</div><div class="line">    <span class="keyword">int</span> SET_PROCESS_STATE_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">49</span>;</div><div class="line">    <span class="keyword">int</span> SCHEDULE_INSTALL_PROVIDER_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">50</span>;</div><div class="line">    <span class="keyword">int</span> UPDATE_TIME_PREFS_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">51</span>;</div><div class="line">    <span class="keyword">int</span> CANCEL_VISIBLE_BEHIND_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">52</span>;</div><div class="line">    <span class="keyword">int</span> BACKGROUND_VISIBLE_BEHIND_CHANGED_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">53</span>;</div><div class="line">    <span class="keyword">int</span> ENTER_ANIMATION_COMPLETE_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">54</span>;</div><div class="line">    <span class="keyword">int</span> NOTIFY_CLEARTEXT_NETWORK_TRANSACTION = IBinder.FIRST_CALL_TRANSACTION+<span class="number">55</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°<code>IApplicationThread</code>å®ƒç»§æ‰¿äº†IInterfaceæ¥å£ï¼Œæ˜¯ä¸€ä¸ªBinderç±»å‹æ¥å£ã€‚é‡Œé¢åŒ…å«äº†å¤§é‡çš„å¯åŠ¨ã€åœæ­¢Activityçš„æ¥å£ï¼Œå¯åŠ¨ã€åœæ­¢Serviceçš„æ¥å£ã€‚é‚£ä¹ˆå®ƒçš„å®ç°è€…åˆ°åº•æ˜¯è°å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯<code>ActivityThread</code>ç±»é‡Œçš„å†…éƒ¨ç±»<code>ApplicationThread</code>ï¼Œæˆ‘ä»¬å»çœ‹çœ‹å®ƒçš„å®šä¹‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationThread</span> <span class="keyword">extends</span> <span class="title">ApplicationThreadNative</span> </span>&#123;...&#125;</div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationThreadNative</span> <span class="keyword">extends</span> <span class="title">Binder</span></span></div><div class="line">        <span class="keyword">implements</span> <span class="title">IApplicationThread</span> &#123;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>ApplicationThread</code>ç±»ç»§æ‰¿è‡ª<code>ApplicationThreadNative</code>ï¼Œè€Œ<code>ApplicationThreadNative</code>æ˜¯ä¸€ä¸ªBinderå¯¹è±¡å¹¶ä¸”å®ç°äº†<code>IApplicationThread</code>æ¥å£ã€‚</p>
<p>è€Œä¸”åœ¨<code>ApplicationThreadNative</code>ç±»çš„å†…éƒ¨æœ‰ä¸€ä¸ª<code>ApplicationThreadProxy</code>ä»£ç†ç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationThreadNative</span> <span class="keyword">extends</span> <span class="title">Binder</span></span></div><div class="line">    <span class="keyword">implements</span> <span class="title">IApplicationThread</span> &#123;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * Cast a Binder object into an application thread interface, generating</div><div class="line">	 * a proxy if needed.</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">static</span> <span class="keyword">public</span> IApplicationThread <span class="title">asInterface</span><span class="params">(IBinder obj)</span> </span>&#123;</div><div class="line">	    <span class="keyword">if</span> (obj == <span class="keyword">null</span>) &#123;</div><div class="line">	        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">	    &#125;</div><div class="line">	    IApplicationThread in =</div><div class="line">	        (IApplicationThread)obj.queryLocalInterface(descriptor);</div><div class="line">	    <span class="keyword">if</span> (in != <span class="keyword">null</span>) &#123;</div><div class="line">	        <span class="keyword">return</span> in;</div><div class="line">	    &#125;</div><div class="line">	    <span class="keyword">return</span> <span class="keyword">new</span> ApplicationThreadProxy(obj);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ApplicationThreadNative</span><span class="params">()</span> </span>&#123;</div><div class="line">	    attachInterface(<span class="keyword">this</span>, descriptor);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTransact</span><span class="params">(<span class="keyword">int</span> code, Parcel data, Parcel reply, <span class="keyword">int</span> flags)</span></span></div><div class="line">	        <span class="keyword">throws</span> RemoteException &#123;</div><div class="line">	    <span class="keyword">switch</span> (code) &#123;</div><div class="line">	    <span class="keyword">case</span> SCHEDULE_PAUSE_ACTIVITY_TRANSACTION:</div><div class="line">	    &#123;</div><div class="line">	        data.enforceInterface(IApplicationThread.descriptor);</div><div class="line">	        IBinder b = data.readStrongBinder();</div><div class="line">	        <span class="keyword">boolean</span> finished = data.readInt() != <span class="number">0</span>;</div><div class="line">	        <span class="keyword">boolean</span> userLeaving = data.readInt() != <span class="number">0</span>;</div><div class="line">	        <span class="keyword">int</span> configChanges = data.readInt();</div><div class="line">	        <span class="keyword">boolean</span> dontReport = data.readInt() != <span class="number">0</span>;</div><div class="line">	        schedulePauseActivity(b, finished, userLeaving, configChanges, dontReport);</div><div class="line">	        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">	    &#125;</div><div class="line">	    <span class="keyword">case</span> SCHEDULE_STOP_ACTIVITY_TRANSACTION:</div><div class="line">	    &#123;</div><div class="line">	        data.enforceInterface(IApplicationThread.descriptor);</div><div class="line">	        IBinder b = data.readStrongBinder();</div><div class="line">	        <span class="keyword">boolean</span> show = data.readInt() != <span class="number">0</span>;</div><div class="line">	        <span class="keyword">int</span> configChanges = data.readInt();</div><div class="line">	        scheduleStopActivity(b, show, configChanges);</div><div class="line">	        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">	    &#125;</div><div class="line"></div><div class="line">	    <span class="comment">//...çœç•¥ä¸€å¤§ç‰‡ä»£ç ...</span></div><div class="line"></div><div class="line">	    <span class="keyword">return</span> <span class="keyword">super</span>.onTransact(code, data, reply, flags);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ApplicationThreadProxy</span> <span class="keyword">implements</span> <span class="title">IApplicationThread</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> IBinder mRemote;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ApplicationThreadProxy</span><span class="params">(IBinder remote)</span> </span>&#123;</div><div class="line">	    mRemote = remote;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">final</span> IBinder <span class="title">asBinder</span><span class="params">()</span> </span>&#123;</div><div class="line">	    <span class="keyword">return</span> mRemote;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">schedulePauseActivity</span><span class="params">(IBinder token, <span class="keyword">boolean</span> finished,</span></span></div><div class="line">	        <span class="keyword">boolean</span> userLeaving, <span class="keyword">int</span> configChanges, <span class="keyword">boolean</span> dontReport) <span class="keyword">throws</span> RemoteException &#123;</div><div class="line">	    Parcel data = Parcel.obtain();</div><div class="line">	    data.writeInterfaceToken(IApplicationThread.descriptor);</div><div class="line">	    data.writeStrongBinder(token);</div><div class="line">	    data.writeInt(finished ? <span class="number">1</span> : <span class="number">0</span>);</div><div class="line">	    data.writeInt(userLeaving ? <span class="number">1</span> :<span class="number">0</span>);</div><div class="line">	    data.writeInt(configChanges);</div><div class="line">	    data.writeInt(dontReport ? <span class="number">1</span> : <span class="number">0</span>);</div><div class="line">	    mRemote.transact(SCHEDULE_PAUSE_ACTIVITY_TRANSACTION, data, <span class="keyword">null</span>,</div><div class="line">	            IBinder.FLAG_ONEWAY);</div><div class="line">	    data.recycle();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">scheduleStopActivity</span><span class="params">(IBinder token, <span class="keyword">boolean</span> showWindow,</span></span></div><div class="line">	        <span class="keyword">int</span> configChanges) <span class="keyword">throws</span> RemoteException &#123;</div><div class="line">	    Parcel data = Parcel.obtain();</div><div class="line">	    data.writeInterfaceToken(IApplicationThread.descriptor);</div><div class="line">	    data.writeStrongBinder(token);</div><div class="line">	    data.writeInt(showWindow ? <span class="number">1</span> : <span class="number">0</span>);</div><div class="line">	    data.writeInt(configChanges);</div><div class="line">	    mRemote.transact(SCHEDULE_STOP_ACTIVITY_TRANSACTION, data, <span class="keyword">null</span>,</div><div class="line">	            IBinder.FLAG_ONEWAY);</div><div class="line">	    data.recycle();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//...çœç•¥ä¸€å¤§ç‰‡ä»£ç ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŒ‰ç…§ä¸Šé¢çš„æµç¨‹ï¼Œæœ€ç»ˆä»AMSå›è°ƒåˆ°äº†<code>ApplicationThread</code>ä¸­ï¼Œæˆ‘ä»¬çœ‹çœ‹<code>ApplicationThread</code>ç±»çš„<code>scheduleLaunchActivity()</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">//ä½äºActivityThreadç±»ä¸­çš„å†…éƒ¨ç±»ApplicationThreadç±»ä¸­</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// we use token to identify this activity without having to send the</span></div><div class="line"><span class="comment">// activity itself back to the activity manager. (matters more with ipc)</span></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">scheduleLaunchActivity</span><span class="params">(Intent intent, IBinder token, <span class="keyword">int</span> ident,</span></span></div><div class="line">        ActivityInfo info, Configuration curConfig, Configuration overrideConfig,</div><div class="line">        CompatibilityInfo compatInfo, String referrer, IVoiceInteractor voiceInteractor,</div><div class="line">        <span class="keyword">int</span> procState, Bundle state, PersistableBundle persistentState,</div><div class="line">        List&lt;ResultInfo&gt; pendingResults, List&lt;ReferrerIntent&gt; pendingNewIntents,</div><div class="line">        <span class="keyword">boolean</span> notResumed, <span class="keyword">boolean</span> isForward, ProfilerInfo profilerInfo) &#123;</div><div class="line">    updateProcessState(procState, <span class="keyword">false</span>);</div><div class="line">    ActivityClientRecord r = <span class="keyword">new</span> ActivityClientRecord();</div><div class="line">    r.token = token;</div><div class="line">    r.ident = ident;</div><div class="line">    r.intent = intent;</div><div class="line">    r.referrer = referrer;</div><div class="line">    r.voiceInteractor = voiceInteractor;</div><div class="line">    r.activityInfo = info;</div><div class="line">    r.compatInfo = compatInfo;</div><div class="line">    r.state = state;</div><div class="line">    r.persistentState = persistentState;</div><div class="line">    r.pendingResults = pendingResults;</div><div class="line">    r.pendingIntents = pendingNewIntents;</div><div class="line">    r.startsNotResumed = notResumed;</div><div class="line">    r.isForward = isForward;</div><div class="line">    r.profilerInfo = profilerInfo;</div><div class="line">    r.overrideConfig = overrideConfig;</div><div class="line">    updatePendingConfiguration(curConfig);</div><div class="line">    sendMessage(H.LAUNCH_ACTIVITY, r);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>scheduleLaunchActivity</code>æ–¹æ³•å°±æ˜¯å‘é€äº†ä¸€ä¸ªå¯åŠ¨Activityçš„Messageäº¤ç»™Hè¿™ä¸ªHandlerï¼Œè¿™ä¸ªHandlerå®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">H</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> LAUNCH_ACTIVITY         = <span class="number">100</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PAUSE_ACTIVITY          = <span class="number">101</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PAUSE_ACTIVITY_FINISHING= <span class="number">102</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STOP_ACTIVITY_SHOW      = <span class="number">103</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STOP_ACTIVITY_HIDE      = <span class="number">104</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SHOW_WINDOW             = <span class="number">105</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> HIDE_WINDOW             = <span class="number">106</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RESUME_ACTIVITY         = <span class="number">107</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SEND_RESULT             = <span class="number">108</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DESTROY_ACTIVITY        = <span class="number">109</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BIND_APPLICATION        = <span class="number">110</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> EXIT_APPLICATION        = <span class="number">111</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NEW_INTENT              = <span class="number">112</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RECEIVER                = <span class="number">113</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CREATE_SERVICE          = <span class="number">114</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SERVICE_ARGS            = <span class="number">115</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STOP_SERVICE            = <span class="number">116</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CONFIGURATION_CHANGED   = <span class="number">118</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CLEAN_UP_CONTEXT        = <span class="number">119</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> GC_WHEN_IDLE            = <span class="number">120</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BIND_SERVICE            = <span class="number">121</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> UNBIND_SERVICE          = <span class="number">122</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DUMP_SERVICE            = <span class="number">123</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> LOW_MEMORY              = <span class="number">124</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ACTIVITY_CONFIGURATION_CHANGED = <span class="number">125</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RELAUNCH_ACTIVITY       = <span class="number">126</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PROFILER_CONTROL        = <span class="number">127</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CREATE_BACKUP_AGENT     = <span class="number">128</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DESTROY_BACKUP_AGENT    = <span class="number">129</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SUICIDE                 = <span class="number">130</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> REMOVE_PROVIDER         = <span class="number">131</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ENABLE_JIT              = <span class="number">132</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DISPATCH_PACKAGE_BROADCAST = <span class="number">133</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SCHEDULE_CRASH          = <span class="number">134</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DUMP_HEAP               = <span class="number">135</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DUMP_ACTIVITY           = <span class="number">136</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SLEEPING                = <span class="number">137</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SET_CORE_SETTINGS       = <span class="number">138</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> UPDATE_PACKAGE_COMPATIBILITY_INFO = <span class="number">139</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TRIM_MEMORY             = <span class="number">140</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DUMP_PROVIDER           = <span class="number">141</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> UNSTABLE_PROVIDER_DIED  = <span class="number">142</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> REQUEST_ASSIST_CONTEXT_EXTRAS = <span class="number">143</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TRANSLUCENT_CONVERSION_COMPLETE = <span class="number">144</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> INSTALL_PROVIDER        = <span class="number">145</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ON_NEW_ACTIVITY_OPTIONS = <span class="number">146</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CANCEL_VISIBLE_BEHIND = <span class="number">147</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BACKGROUND_VISIBLE_BEHIND_CHANGED = <span class="number">148</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ENTER_ANIMATION_COMPLETE = <span class="number">149</span>;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (DEBUG_MESSAGES) Slog.v(TAG, <span class="string">"&gt;&gt;&gt; handling: "</span> + codeToString(msg.what));</div><div class="line">        <span class="keyword">switch</span> (msg.what) &#123;</div><div class="line">            <span class="keyword">case</span> LAUNCH_ACTIVITY: &#123;</div><div class="line">                Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="string">"activityStart"</span>);</div><div class="line">                <span class="keyword">final</span> ActivityClientRecord r = (ActivityClientRecord) msg.obj;</div><div class="line">                r.packageInfo = getPackageInfoNoCheck(</div><div class="line">                        r.activityInfo.applicationInfo, r.compatInfo);</div><div class="line">                handleLaunchActivity(r, <span class="keyword">null</span>);</div><div class="line">                Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);</div><div class="line">            &#125; <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> RELAUNCH_ACTIVITY: &#123;</div><div class="line">                Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="string">"activityRestart"</span>);</div><div class="line">                ActivityClientRecord r = (ActivityClientRecord)msg.obj;</div><div class="line">                handleRelaunchActivity(r);</div><div class="line">                Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);</div><div class="line">            &#125; <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> PAUSE_ACTIVITY:</div><div class="line">                Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="string">"activityPause"</span>);</div><div class="line">                handlePauseActivity((IBinder)msg.obj, <span class="keyword">false</span>, (msg.arg1&amp;<span class="number">1</span>) != <span class="number">0</span>, msg.arg2,</div><div class="line">                        (msg.arg1&amp;<span class="number">2</span>) != <span class="number">0</span>);</div><div class="line">                maybeSnapshot();</div><div class="line">                Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> PAUSE_ACTIVITY_FINISHING:</div><div class="line">                Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="string">"activityPause"</span>);</div><div class="line">                handlePauseActivity((IBinder)msg.obj, <span class="keyword">true</span>, (msg.arg1&amp;<span class="number">1</span>) != <span class="number">0</span>, msg.arg2,</div><div class="line">                        (msg.arg1&amp;<span class="number">1</span>) != <span class="number">0</span>);</div><div class="line">                Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> STOP_ACTIVITY_SHOW:</div><div class="line">                Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="string">"activityStop"</span>);</div><div class="line">                handleStopActivity((IBinder)msg.obj, <span class="keyword">true</span>, msg.arg2);</div><div class="line">                Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> STOP_ACTIVITY_HIDE:</div><div class="line">                Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="string">"activityStop"</span>);</div><div class="line">                handleStopActivity((IBinder)msg.obj, <span class="keyword">false</span>, msg.arg2);</div><div class="line">                Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> SHOW_WINDOW:</div><div class="line">                Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="string">"activityShowWindow"</span>);</div><div class="line">                handleWindowVisibility((IBinder)msg.obj, <span class="keyword">true</span>);</div><div class="line">                Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> HIDE_WINDOW:</div><div class="line">                Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="string">"activityHideWindow"</span>);</div><div class="line">                handleWindowVisibility((IBinder)msg.obj, <span class="keyword">false</span>);</div><div class="line">                Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> RESUME_ACTIVITY:</div><div class="line">                Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="string">"activityResume"</span>);</div><div class="line">                handleResumeActivity((IBinder) msg.obj, <span class="keyword">true</span>, msg.arg1 != <span class="number">0</span>, <span class="keyword">true</span>);</div><div class="line">                Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line"></div><div class="line">            <span class="comment">//...çœç•¥å…¶ä»–ä»£ç ...</span></div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//...çœç•¥å…¶ä»–ä»£ç ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Hè¿™ä¸ªHandlerå¯¹<code>LAUNCH_ACTIVITY</code>çš„å¤„ç†å°±æ˜¯è°ƒç”¨äº†<code>handleLaunchActivity</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">//ActivityThreadç±»ä¸­</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handleLaunchActivity</span><span class="params">(ActivityClientRecord r, Intent customIntent)</span> </span>&#123;</div><div class="line">    <span class="comment">// If we are getting ready to gc after going to the background, well</span></div><div class="line">    <span class="comment">// we are back active so skip it.</span></div><div class="line">    unscheduleGcIdler();</div><div class="line">    mSomeActivitiesChanged = <span class="keyword">true</span>;</div><div class="line">    <span class="keyword">if</span> (r.profilerInfo != <span class="keyword">null</span>) &#123;</div><div class="line">        mProfiler.setProfiler(r.profilerInfo);</div><div class="line">        mProfiler.startProfiling();</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// Make sure we are running with the most recent config.</span></div><div class="line">    handleConfigurationChanged(<span class="keyword">null</span>, <span class="keyword">null</span>);</div><div class="line">    <span class="keyword">if</span> (localLOGV) Slog.v(</div><div class="line">        TAG, <span class="string">"Handling launch of "</span> + r);</div><div class="line">    <span class="comment">// Initialize before creating the activity</span></div><div class="line">    WindowManagerGlobal.initialize();</div><div class="line">  </div><div class="line">    <span class="comment">//æ³¨æ„è¿™é‡Œ</span></div><div class="line">    Activity a = performLaunchActivity(r, customIntent);</div><div class="line">    <span class="keyword">if</span> (a != <span class="keyword">null</span>) &#123;</div><div class="line">        r.createdConfig = <span class="keyword">new</span> Configuration(mConfiguration);</div><div class="line">        Bundle oldState = r.state;</div><div class="line">      </div><div class="line">        <span class="comment">//æ³¨æ„è¿™é‡Œ</span></div><div class="line">        handleResumeActivity(r.token, <span class="keyword">false</span>, r.isForward,</div><div class="line">                !r.activity.mFinished &amp;&amp; !r.startsNotResumed);</div><div class="line">        <span class="keyword">if</span> (!r.activity.mFinished &amp;&amp; r.startsNotResumed) &#123;</div><div class="line">            <span class="comment">// The activity manager actually wants this one to start out</span></div><div class="line">            <span class="comment">// paused, because it needs to be visible but isn't in the</span></div><div class="line">            <span class="comment">// foreground.  We accomplish this by going through the</span></div><div class="line">            <span class="comment">// normal startup (because activities expect to go through</span></div><div class="line">            <span class="comment">// onResume() the first time they run, before their window</span></div><div class="line">            <span class="comment">// is displayed), and then pausing it.  However, in this case</span></div><div class="line">            <span class="comment">// we do -not- need to do the full pause cycle (of freezing</span></div><div class="line">            <span class="comment">// and such) because the activity manager assumes it can just</span></div><div class="line">            <span class="comment">// retain the current state it has.</span></div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                r.activity.mCalled = <span class="keyword">false</span>;</div><div class="line">                mInstrumentation.callActivityOnPause(r.activity);</div><div class="line">                <span class="comment">// We need to keep around the original state, in case</span></div><div class="line">                <span class="comment">// we need to be created again.  But we only do this</span></div><div class="line">                <span class="comment">// for pre-Honeycomb apps, which always save their state</span></div><div class="line">                <span class="comment">// when pausing, so we can not have them save their state</span></div><div class="line">                <span class="comment">// when restarting from a paused state.  For HC and later,</span></div><div class="line">                <span class="comment">// we want to (and can) let the state be saved as the normal</span></div><div class="line">                <span class="comment">// part of stopping the activity.</span></div><div class="line">                <span class="keyword">if</span> (r.isPreHoneycomb()) &#123;</div><div class="line">                    r.state = oldState;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (!r.activity.mCalled) &#123;</div><div class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> SuperNotCalledException(</div><div class="line">                        <span class="string">"Activity "</span> + r.intent.getComponent().toShortString() +</div><div class="line">                        <span class="string">" did not call through to super.onPause()"</span>);</div><div class="line">                &#125;</div><div class="line">            &#125; <span class="keyword">catch</span> (SuperNotCalledException e) &#123;</div><div class="line">                <span class="keyword">throw</span> e;</div><div class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">                <span class="keyword">if</span> (!mInstrumentation.onException(r.activity, e)) &#123;</div><div class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</div><div class="line">                            <span class="string">"Unable to pause activity "</span></div><div class="line">                            + r.intent.getComponent().toShortString()</div><div class="line">                            + <span class="string">": "</span> + e.toString(), e);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            r.paused = <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// If there was an error, for any reason, tell the activity</span></div><div class="line">        <span class="comment">// manager to stop us.</span></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            ActivityManagerNative.getDefault()</div><div class="line">                .finishActivity(r.token, Activity.RESULT_CANCELED, <span class="keyword">null</span>, <span class="keyword">false</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (RemoteException ex) &#123;</div><div class="line">            <span class="comment">// Ignore</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æœ€ç»ˆï¼š</p>
<ol>
<li>é€šè¿‡ActivityThreadçš„<code>performLaunchActivity()</code>æ–¹æ³•å®Œæˆäº†Activityçš„åˆ›å»ºå’Œå¯åŠ¨è¿‡ç¨‹ï¼›</li>
<li>é€šè¿‡<code>handleResumeActivity()</code>æ–¹æ³•è°ƒç”¨äº†è¿™ä¸ªActivityçš„<code>onResume()</code>ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚</li>
</ol>
<h3 id="performLaunchActivity-æ–¹æ³•"><a href="#performLaunchActivity-æ–¹æ³•" class="headerlink" title="performLaunchActivity()æ–¹æ³•"></a><code>performLaunchActivity()</code>æ–¹æ³•</h3><p><code>performLaunchActivity()</code>æ–¹æ³•ä¸»è¦å®Œæˆäº†Activityçš„åˆå§‹åŒ–ä»»åŠ¡ï¼Œæ ¹æ®æ³¨é‡Šå¤§è‡´å¯ä»¥åˆ†ä¸ºå››æ­¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> Activity <span class="title">performLaunchActivity</span><span class="params">(ActivityClientRecord r, Intent customIntent)</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="comment">//1. ä»ActivityClientRecordä¸­è¯»å–Activityçš„ç»„ä»¶ä¿¡æ¯</span></div><div class="line">    ActivityInfo aInfo = r.activityInfo;</div><div class="line">    <span class="keyword">if</span> (r.packageInfo == <span class="keyword">null</span>) &#123;</div><div class="line">        r.packageInfo = getPackageInfo(aInfo.applicationInfo, r.compatInfo,</div><div class="line">                Context.CONTEXT_INCLUDE_CODE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    ComponentName component = r.intent.getComponent();</div><div class="line">    <span class="keyword">if</span> (component == <span class="keyword">null</span>) &#123;</div><div class="line">        component = r.intent.resolveActivity(</div><div class="line">            mInitialApplication.getPackageManager());</div><div class="line">        r.intent.setComponent(component);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (r.activityInfo.targetActivity != <span class="keyword">null</span>) &#123;</div><div class="line">        component = <span class="keyword">new</span> ComponentName(r.activityInfo.packageName,</div><div class="line">                r.activityInfo.targetActivity);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    Activity activity = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        java.lang.ClassLoader cl = r.packageInfo.getClassLoader();</div><div class="line"></div><div class="line">        <span class="comment">//2. é€šè¿‡mInstrumentation.newActivity()æ–¹æ³•åˆ›å»ºActivityå¯¹è±¡</span></div><div class="line">        activity = mInstrumentation.newActivity(</div><div class="line">                cl, component.getClassName(), r.intent);</div><div class="line">        StrictMode.incrementExpectedActivityCount(activity.getClass());</div><div class="line">        r.intent.setExtrasClassLoader(cl);</div><div class="line">        r.intent.prepareToEnterProcess();</div><div class="line">        <span class="keyword">if</span> (r.state != <span class="keyword">null</span>) &#123;</div><div class="line">            r.state.setClassLoader(cl);</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        <span class="keyword">if</span> (!mInstrumentation.onException(activity, e)) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</div><div class="line">                <span class="string">"Unable to instantiate activity "</span> + component</div><div class="line">                + <span class="string">": "</span> + e.toString(), e);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">    	<span class="comment">//3. é€šè¿‡LoadApkçš„makeApplication()æ–¹æ³•åˆ›å»ºApplicationå¯¹è±¡</span></div><div class="line">        Application app = r.packageInfo.makeApplication(<span class="keyword">false</span>, mInstrumentation);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (localLOGV) Slog.v(TAG, <span class="string">"Performing launch of "</span> + r);</div><div class="line">        <span class="keyword">if</span> (localLOGV) Slog.v(</div><div class="line">                TAG, r + <span class="string">": app="</span> + app</div><div class="line">                + <span class="string">", appName="</span> + app.getPackageName()</div><div class="line">                + <span class="string">", pkg="</span> + r.packageInfo.getPackageName()</div><div class="line">                + <span class="string">", comp="</span> + r.intent.getComponent().toShortString()</div><div class="line">                + <span class="string">", dir="</span> + r.packageInfo.getAppDir());</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (activity != <span class="keyword">null</span>) &#123;</div><div class="line">        </div><div class="line">        	<span class="comment">//4. åˆ›å»ºContextImplå¯¹è±¡å¹¶è°ƒç”¨Activityçš„attach()æ–¹æ³•å®Œæˆåˆå§‹åŒ–</span></div><div class="line">            Context appContext = createBaseContextForActivity(r, activity);</div><div class="line">            CharSequence title = r.activityInfo.loadLabel(appContext.getPackageManager());</div><div class="line">            Configuration config = <span class="keyword">new</span> Configuration(mCompatConfiguration);</div><div class="line">            <span class="keyword">if</span> (DEBUG_CONFIGURATION) Slog.v(TAG, <span class="string">"Launching activity "</span></div><div class="line">                    + r.activityInfo.name + <span class="string">" with config "</span> + config);</div><div class="line">            activity.attach(appContext, <span class="keyword">this</span>, getInstrumentation(), r.token,</div><div class="line">                    r.ident, app, r.intent, r.activityInfo, title, r.parent,</div><div class="line">                    r.embeddedID, r.lastNonConfigurationInstances, config,</div><div class="line">                    r.referrer, r.voiceInteractor);</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (customIntent != <span class="keyword">null</span>) &#123;</div><div class="line">                activity.mIntent = customIntent;</div><div class="line">            &#125;</div><div class="line">            r.lastNonConfigurationInstances = <span class="keyword">null</span>;</div><div class="line">            activity.mStartedActivity = <span class="keyword">false</span>;</div><div class="line">            <span class="keyword">int</span> theme = r.activityInfo.getThemeResource();</div><div class="line">            <span class="keyword">if</span> (theme != <span class="number">0</span>) &#123;</div><div class="line">                activity.setTheme(theme);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            activity.mCalled = <span class="keyword">false</span>;</div><div class="line">            <span class="comment">//5. é€šè¿‡Instrumentationçš„callActivityOnCreateæ–¹æ³•è°ƒç”¨Activityçš„onCreate()æ–¹æ³•</span></div><div class="line">            <span class="keyword">if</span> (r.isPersistable()) &#123;</div><div class="line">                mInstrumentation.callActivityOnCreate(activity, r.state, r.persistentState);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                mInstrumentation.callActivityOnCreate(activity, r.state);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (!activity.mCalled) &#123;</div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> SuperNotCalledException(</div><div class="line">                    <span class="string">"Activity "</span> + r.intent.getComponent().toShortString() +</div><div class="line">                    <span class="string">" did not call through to super.onCreate()"</span>);</div><div class="line">            &#125;</div><div class="line">            r.activity = activity;</div><div class="line">            r.stopped = <span class="keyword">true</span>;</div><div class="line">            <span class="keyword">if</span> (!r.activity.mFinished) &#123;</div><div class="line">                activity.performStart();</div><div class="line">                r.stopped = <span class="keyword">false</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (!r.activity.mFinished) &#123;</div><div class="line">                <span class="keyword">if</span> (r.isPersistable()) &#123;</div><div class="line">                    <span class="keyword">if</span> (r.state != <span class="keyword">null</span> || r.persistentState != <span class="keyword">null</span>) &#123;</div><div class="line">                        mInstrumentation.callActivityOnRestoreInstanceState(activity, r.state,</div><div class="line">                                r.persistentState);</div><div class="line">                    &#125;</div><div class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (r.state != <span class="keyword">null</span>) &#123;</div><div class="line">                    mInstrumentation.callActivityOnRestoreInstanceState(activity, r.state);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (!r.activity.mFinished) &#123;</div><div class="line">                activity.mCalled = <span class="keyword">false</span>;</div><div class="line">                <span class="keyword">if</span> (r.isPersistable()) &#123;</div><div class="line">                    mInstrumentation.callActivityOnPostCreate(activity, r.state,</div><div class="line">                            r.persistentState);</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    mInstrumentation.callActivityOnPostCreate(activity, r.state);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (!activity.mCalled) &#123;</div><div class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> SuperNotCalledException(</div><div class="line">                        <span class="string">"Activity "</span> + r.intent.getComponent().toShortString() +</div><div class="line">                        <span class="string">" did not call through to super.onPostCreate()"</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        r.paused = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">        mActivities.put(r.token, r);</div><div class="line"></div><div class="line">    &#125; <span class="keyword">catch</span> (SuperNotCalledException e) &#123;</div><div class="line">        <span class="keyword">throw</span> e;</div><div class="line"></div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        <span class="keyword">if</span> (!mInstrumentation.onException(activity, e)) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</div><div class="line">                <span class="string">"Unable to start activity "</span> + component</div><div class="line">                + <span class="string">": "</span> + e.toString(), e);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> activity;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ€»ç»“ä¸Šé¢çš„<code>performLaunchActivity()</code>æ–¹æ³•ï¼Œä¸»è¦å®Œæˆäº†å¦‚ä¸‹å·¥ä½œï¼š</p>
<ol>
<li>ä»ActivityClientRecordä¸­è¯»å–Activityçš„ç»„ä»¶ä¿¡æ¯</li>
<li>é€šè¿‡<code>mInstrumentation.newActivity()</code>æ–¹æ³•åˆ›å»ºActivityå¯¹è±¡</li>
<li>é€šè¿‡LoadApkçš„<code>makeApplication()</code>æ–¹æ³•åˆ›å»ºApplicationå¯¹è±¡</li>
<li>åˆ›å»º<code>ContextImpl</code>å¯¹è±¡å¹¶è°ƒç”¨Activityçš„<code>attach()</code>æ–¹æ³•å®Œæˆåˆå§‹åŒ–</li>
<li>é€šè¿‡Instrumentationçš„<code>callActivityOnCreate</code>æ–¹æ³•è°ƒç”¨Activityçš„<code>onCreate()</code>æ–¹æ³•</li>
</ol>
<p>æˆ‘ä»¬è·Ÿè¿›ä¸€ä¸‹ç¬¬äºŒæ­¥çš„<code>Instrumentation</code>ç±»çš„<code>newActivity()</code>æ–¹æ³•ï¼Œå¾ˆç®€å•ï¼Œå°±æ˜¯ä½¿ç”¨ç±»åŠ è½½å™¨åˆ›å»ºäº†Activityå¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">//Instrumentationç±»</span></div><div class="line"><span class="function"><span class="keyword">public</span> Activity <span class="title">newActivity</span><span class="params">(ClassLoader cl, String className,</span></span></div><div class="line">        Intent intent)</div><div class="line">        <span class="keyword">throws</span> InstantiationException, IllegalAccessException,</div><div class="line">        ClassNotFoundException &#123;</div><div class="line">    <span class="keyword">return</span> (Activity)cl.loadClass(className).newInstance();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç¬¬ä¸‰æ­¥ï¼šé€šè¿‡LoadApkçš„<code>makeApplication()</code>æ–¹æ³•åˆ›å»ºApplicationå¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">//LoadApkç±»</span></div><div class="line"><span class="function"><span class="keyword">public</span> Application <span class="title">makeApplication</span><span class="params">(<span class="keyword">boolean</span> forceDefaultAppClass,</span></span></div><div class="line">        Instrumentation instrumentation) &#123;</div><div class="line">    <span class="keyword">if</span> (mApplication != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">return</span> mApplication;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    Application app = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">    String appClass = mApplicationInfo.className;</div><div class="line">    <span class="keyword">if</span> (forceDefaultAppClass || (appClass == <span class="keyword">null</span>)) &#123;</div><div class="line">        appClass = <span class="string">"android.app.Application"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        java.lang.ClassLoader cl = getClassLoader();</div><div class="line">        <span class="keyword">if</span> (!mPackageName.equals(<span class="string">"android"</span>)) &#123;</div><div class="line">            initializeJavaContextClassLoader();</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//é€šè¿‡Instrumentationç±»çš„newApplicationæ–¹æ³•åˆ›å»ºApplicationå¯¹è±¡</span></div><div class="line">        ContextImpl appContext = ContextImpl.createAppContext(mActivityThread, <span class="keyword">this</span>);</div><div class="line">        app = mActivityThread.mInstrumentation.newApplication(</div><div class="line">                cl, appClass, appContext);</div><div class="line">        appContext.setOuterContext(app);</div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        <span class="keyword">if</span> (!mActivityThread.mInstrumentation.onException(app, e)) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</div><div class="line">                <span class="string">"Unable to instantiate application "</span> + appClass</div><div class="line">                + <span class="string">": "</span> + e.toString(), e);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    mActivityThread.mAllApplications.add(app);</div><div class="line">    mApplication = app;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (instrumentation != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            instrumentation.callApplicationOnCreate(app);</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            <span class="keyword">if</span> (!instrumentation.onException(app, e)) &#123;</div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</div><div class="line">                    <span class="string">"Unable to create application "</span> + app.getClass().getName()</div><div class="line">                    + <span class="string">": "</span> + e.toString(), e);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Rewrite the R 'constants' for all library apks.</span></div><div class="line">    SparseArray&lt;String&gt; packageIdentifiers = getAssets(mActivityThread)</div><div class="line">            .getAssignedPackageIdentifiers();</div><div class="line">    <span class="keyword">final</span> <span class="keyword">int</span> N = packageIdentifiers.size();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> id = packageIdentifiers.keyAt(i);</div><div class="line">        <span class="keyword">if</span> (id == <span class="number">0x01</span> || id == <span class="number">0x7f</span>) &#123;</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        rewriteRValues(getClassLoader(), packageIdentifiers.valueAt(i), id);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> app;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è·Ÿè¿›å»Instrumentationç±»çš„<code>newApplication()</code>æ–¹æ³•çœ‹çœ‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">//Instrumentationç±»</span></div><div class="line"><span class="function"><span class="keyword">public</span> Application <span class="title">newApplication</span><span class="params">(ClassLoader cl, String className, Context context)</span></span></div><div class="line">        <span class="keyword">throws</span> InstantiationException, IllegalAccessException, </div><div class="line">        ClassNotFoundException &#123;</div><div class="line">    <span class="keyword">return</span> newApplication(cl.loadClass(className), context);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">public</span> Application <span class="title">newApplication</span><span class="params">(Class&lt;?&gt; clazz, Context context)</span></span></div><div class="line">        <span class="keyword">throws</span> InstantiationException, IllegalAccessException, </div><div class="line">        ClassNotFoundException &#123;</div><div class="line">    Application app = (Application)clazz.newInstance();</div><div class="line">    app.attach(context);</div><div class="line">    <span class="keyword">return</span> app;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//æœ€ç»ˆè°ƒç”¨äº†Applicationç±»çš„attachæ–¹æ³•</span></div><div class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">attach</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">    attachBaseContext(context);		<span class="comment">//ç†Ÿæ‚‰çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</span></div><div class="line">    mLoadedApk = ContextImpl.getImpl(context).mPackageInfo;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å®ƒé€šè¿‡ç±»åŠ è½½å™¨åˆ›å»ºäº†Applicationçš„å¯¹è±¡ï¼Œå½“Applicationå¯¹è±¡åˆ›å»ºå®Œæ¯•ä¹‹åï¼Œç³»ç»Ÿä¼šé€šè¿‡Instrumentationç±»çš„<code>callApplicationOnCreate()</code>æ–¹æ³•æ¥è°ƒç”¨Applicationçš„<code>onCreate()</code>æ–¹æ³•ã€‚æœ€åé€šè¿‡<code>app.attach()</code>è°ƒç”¨äº†æˆ‘ä»¬ç†Ÿæ‚‰çš„Applicationçš„<code>attachBaseContext()</code>æ–¹æ³•ã€‚</p>
<h3 id="handleResumeActivity-æ–¹æ³•æµç¨‹"><a href="#handleResumeActivity-æ–¹æ³•æµç¨‹" class="headerlink" title="handleResumeActivity()æ–¹æ³•æµç¨‹"></a><code>handleResumeActivity()</code>æ–¹æ³•æµç¨‹</h3><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">//ActivityThreadç±»</span></div><div class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">handleResumeActivity</span><span class="params">(IBinder token,</span></span></div><div class="line">        <span class="keyword">boolean</span> clearHide, <span class="keyword">boolean</span> isForward, <span class="keyword">boolean</span> reallyResume) &#123;</div><div class="line">    <span class="comment">// If we are getting ready to gc after going to the background, well</span></div><div class="line">    <span class="comment">// we are back active so skip it.</span></div><div class="line">    unscheduleGcIdler();</div><div class="line">    mSomeActivitiesChanged = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">    <span class="comment">// TODO Push resumeArgs into the activity for consideration</span></div><div class="line">    ActivityClientRecord r = performResumeActivity(token, clearHide);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (r != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">final</span> Activity a = r.activity;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (localLOGV) Slog.v(</div><div class="line">            TAG, <span class="string">"Resume "</span> + r + <span class="string">" started activity: "</span> +</div><div class="line">            a.mStartedActivity + <span class="string">", hideForNow: "</span> + r.hideForNow</div><div class="line">            + <span class="string">", finished: "</span> + a.mFinished);</div><div class="line"></div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> forwardBit = isForward ?</div><div class="line">                WindowManager.LayoutParams.SOFT_INPUT_IS_FORWARD_NAVIGATION : <span class="number">0</span>;</div><div class="line"></div><div class="line">        <span class="comment">// If the window hasn't yet been added to the window manager,</span></div><div class="line">        <span class="comment">// and this guy didn't finish itself or start another activity,</span></div><div class="line">        <span class="comment">// then go ahead and add the window.</span></div><div class="line">        <span class="keyword">boolean</span> willBeVisible = !a.mStartedActivity;</div><div class="line">        <span class="keyword">if</span> (!willBeVisible) &#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                willBeVisible = ActivityManagerNative.getDefault().willActivityBeVisible(</div><div class="line">                        a.getActivityToken());</div><div class="line">            &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (r.window == <span class="keyword">null</span> &amp;&amp; !a.mFinished &amp;&amp; willBeVisible) &#123;</div><div class="line">            r.window = r.activity.getWindow();</div><div class="line">            View decor = r.window.getDecorView();</div><div class="line">            decor.setVisibility(View.INVISIBLE);</div><div class="line">            ViewManager wm = a.getWindowManager();</div><div class="line">            WindowManager.LayoutParams l = r.window.getAttributes();</div><div class="line">            a.mDecor = decor;</div><div class="line">            l.type = WindowManager.LayoutParams.TYPE_BASE_APPLICATION;</div><div class="line">            l.softInputMode |= forwardBit;</div><div class="line">            <span class="keyword">if</span> (a.mVisibleFromClient) &#123;</div><div class="line">                a.mWindowAdded = <span class="keyword">true</span>;</div><div class="line">                wm.addView(decor, l);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        <span class="comment">// If the window has already been added, but during resume</span></div><div class="line">        <span class="comment">// we started another activity, then don't yet make the</span></div><div class="line">        <span class="comment">// window visible.</span></div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!willBeVisible) &#123;</div><div class="line">            <span class="keyword">if</span> (localLOGV) Slog.v(</div><div class="line">                TAG, <span class="string">"Launch "</span> + r + <span class="string">" mStartedActivity set"</span>);</div><div class="line">            r.hideForNow = <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// Get rid of anything left hanging around.</span></div><div class="line">        cleanUpPendingRemoveWindows(r);</div><div class="line"></div><div class="line">        <span class="comment">// The window is now visible if it has been added, we are not</span></div><div class="line">        <span class="comment">// simply finishing, and we are not starting another activity.</span></div><div class="line">        <span class="keyword">if</span> (!r.activity.mFinished &amp;&amp; willBeVisible</div><div class="line">                &amp;&amp; r.activity.mDecor != <span class="keyword">null</span> &amp;&amp; !r.hideForNow) &#123;</div><div class="line">            <span class="keyword">if</span> (r.newConfig != <span class="keyword">null</span>) &#123;</div><div class="line">                r.tmpConfig.setTo(r.newConfig);</div><div class="line">                <span class="keyword">if</span> (r.overrideConfig != <span class="keyword">null</span>) &#123;</div><div class="line">                    r.tmpConfig.updateFrom(r.overrideConfig);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (DEBUG_CONFIGURATION) Slog.v(TAG, <span class="string">"Resuming activity "</span></div><div class="line">                        + r.activityInfo.name + <span class="string">" with newConfig "</span> + r.tmpConfig);</div><div class="line">                performConfigurationChanged(r.activity, r.tmpConfig);</div><div class="line">                freeTextLayoutCachesIfNeeded(r.activity.mCurrentConfig.diff(r.tmpConfig));</div><div class="line">                r.newConfig = <span class="keyword">null</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (localLOGV) Slog.v(TAG, <span class="string">"Resuming "</span> + r + <span class="string">" with isForward="</span></div><div class="line">                    + isForward);</div><div class="line">            WindowManager.LayoutParams l = r.window.getAttributes();</div><div class="line">            <span class="keyword">if</span> ((l.softInputMode</div><div class="line">                    &amp; WindowManager.LayoutParams.SOFT_INPUT_IS_FORWARD_NAVIGATION)</div><div class="line">                    != forwardBit) &#123;</div><div class="line">                l.softInputMode = (l.softInputMode</div><div class="line">                        &amp; (~WindowManager.LayoutParams.SOFT_INPUT_IS_FORWARD_NAVIGATION))</div><div class="line">                        | forwardBit;</div><div class="line">                <span class="keyword">if</span> (r.activity.mVisibleFromClient) &#123;</div><div class="line">                    ViewManager wm = a.getWindowManager();</div><div class="line">                    View decor = r.window.getDecorView();</div><div class="line">                    wm.updateViewLayout(decor, l);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            r.activity.mVisibleFromServer = <span class="keyword">true</span>;</div><div class="line">            mNumVisibleActivities++;</div><div class="line">            <span class="keyword">if</span> (r.activity.mVisibleFromClient) &#123;</div><div class="line">                r.activity.makeVisible();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (!r.onlyLocalRequest) &#123;</div><div class="line">            r.nextIdle = mNewActivities;</div><div class="line">            mNewActivities = r;</div><div class="line">            <span class="keyword">if</span> (localLOGV) Slog.v(</div><div class="line">                TAG, <span class="string">"Scheduling idle handler for "</span> + r);</div><div class="line">            Looper.myQueue().addIdleHandler(<span class="keyword">new</span> Idler());</div><div class="line">        &#125;</div><div class="line">        r.onlyLocalRequest = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">        <span class="comment">// é€šçŸ¥AMSå·²ç»resumeå®Œæˆ Tell the activity manager we have resumed.</span></div><div class="line">        <span class="keyword">if</span> (reallyResume) &#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                ActivityManagerNative.getDefault().activityResumed(token);</div><div class="line">            &#125; <span class="keyword">catch</span> (RemoteException ex) &#123;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// If an exception was thrown when trying to resume, then</span></div><div class="line">        <span class="comment">// just end this activity.</span></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            ActivityManagerNative.getDefault()</div><div class="line">                .finishActivity(token, Activity.RESULT_CANCELED, <span class="keyword">null</span>, <span class="keyword">false</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (RemoteException ex) &#123;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ¥ç€çœ‹<code>performResumeActivity()</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">//ActivityThreadç±»</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> ActivityClientRecord <span class="title">performResumeActivity</span><span class="params">(IBinder token,</span></span></div><div class="line">        <span class="keyword">boolean</span> clearHide) &#123;</div><div class="line">    ActivityClientRecord r = mActivities.get(token);</div><div class="line">    <span class="keyword">if</span> (localLOGV) Slog.v(TAG, <span class="string">"Performing resume of "</span> + r</div><div class="line">            + <span class="string">" finished="</span> + r.activity.mFinished);</div><div class="line">    <span class="keyword">if</span> (r != <span class="keyword">null</span> &amp;&amp; !r.activity.mFinished) &#123;</div><div class="line">        <span class="keyword">if</span> (clearHide) &#123;</div><div class="line">            r.hideForNow = <span class="keyword">false</span>;</div><div class="line">            r.activity.mStartedActivity = <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            r.activity.onStateNotSaved();</div><div class="line">            r.activity.mFragments.noteStateNotSaved();</div><div class="line">            <span class="keyword">if</span> (r.pendingIntents != <span class="keyword">null</span>) &#123;</div><div class="line">                deliverNewIntents(r, r.pendingIntents);</div><div class="line">                r.pendingIntents = <span class="keyword">null</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (r.pendingResults != <span class="keyword">null</span>) &#123;</div><div class="line">                deliverResults(r, r.pendingResults);</div><div class="line">                r.pendingResults = <span class="keyword">null</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//æ³¨æ„è¿™é‡Œï¼Œè°ƒç”¨Activityçš„performResume()æ–¹æ³•</span></div><div class="line">            r.activity.performResume();</div><div class="line"></div><div class="line">            EventLog.writeEvent(LOG_AM_ON_RESUME_CALLED,</div><div class="line">                    UserHandle.myUserId(), r.activity.getComponentName().getClassName());</div><div class="line"></div><div class="line">            r.paused = <span class="keyword">false</span>;</div><div class="line">            r.stopped = <span class="keyword">false</span>;</div><div class="line">            r.state = <span class="keyword">null</span>;</div><div class="line">            r.persistentState = <span class="keyword">null</span>;</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            <span class="keyword">if</span> (!mInstrumentation.onException(r.activity, e)) &#123;</div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</div><div class="line">                    <span class="string">"Unable to resume activity "</span></div><div class="line">                    + r.intent.getComponent().toShortString()</div><div class="line">                    + <span class="string">": "</span> + e.toString(), e);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> r;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ActivityThreadç±»ä¸­çš„<code>performResumeActivity()</code>æ–¹æ³•è°ƒç”¨äº†Activityç±»çš„<code>performResume()</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">//Activityç±»</span></div><div class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">performResume</span><span class="params">()</span> </span>&#123;</div><div class="line">    performRestart();</div><div class="line"></div><div class="line">    mFragments.execPendingActions();</div><div class="line"></div><div class="line">    mLastNonConfigurationInstances = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">    mCalled = <span class="keyword">false</span>;</div><div class="line">    <span class="comment">// çœ‹è¿™é‡Œ mResumed is set by the instrumentation</span></div><div class="line">    mInstrumentation.callActivityOnResume(<span class="keyword">this</span>);</div><div class="line">    <span class="keyword">if</span> (!mCalled) &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> SuperNotCalledException(</div><div class="line">            <span class="string">"Activity "</span> + mComponent.toShortString() +</div><div class="line">            <span class="string">" did not call through to super.onResume()"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Now really resume, and install the current status bar and menu.</span></div><div class="line">    mCalled = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">    mFragments.dispatchResume();</div><div class="line">    mFragments.execPendingActions();</div><div class="line"></div><div class="line">    onPostResume();</div><div class="line">    <span class="keyword">if</span> (!mCalled) &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> SuperNotCalledException(</div><div class="line">            <span class="string">"Activity "</span> + mComponent.toShortString() +</div><div class="line">            <span class="string">" did not call through to super.onPostResume()"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Instrumentationç±»ä¸­çš„<code>callActivityOnResume</code>æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">/** Instrumentationç±»</span></div><div class="line"> * Perform calling of an activity's &#123;<span class="doctag">@link</span> Activity#onResume&#125; method.  The</div><div class="line"> * default implementation simply calls through to that method.</div><div class="line"> * </div><div class="line"> * <span class="doctag">@param</span> activity The activity being resumed.</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callActivityOnResume</span><span class="params">(Activity activity)</span> </span>&#123;</div><div class="line">    activity.mResumed = <span class="keyword">true</span>;</div><div class="line">    activity.onResume();	<span class="comment">//è°ƒç”¨äº†onResume()æ–¹æ³•å®Œæˆäº†å¯åŠ¨è¿‡ç¨‹</span></div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (mActivityMonitors != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">synchronized</span> (mSync) &#123;</div><div class="line">            <span class="keyword">final</span> <span class="keyword">int</span> N = mActivityMonitors.size();</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N; i++) &#123;</div><div class="line">                <span class="keyword">final</span> ActivityMonitor am = mActivityMonitors.get(i);</div><div class="line">                am.match(activity, activity, activity.getIntent());</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="åº”ç”¨çš„ä¸»è¦å¯åŠ¨æµç¨‹"><a href="#åº”ç”¨çš„ä¸»è¦å¯åŠ¨æµç¨‹" class="headerlink" title="åº”ç”¨çš„ä¸»è¦å¯åŠ¨æµç¨‹"></a>åº”ç”¨çš„ä¸»è¦å¯åŠ¨æµç¨‹</h3><p>å…³äº App å¯åŠ¨æµç¨‹çš„æ–‡ç« å¾ˆå¤šï¼Œæ–‡ç« åº•éƒ¨æœ‰ä¸€äº›å¯åŠ¨æµç¨‹ç›¸å…³çš„å‚è€ƒæ–‡ç« ï¼Œè¿™é‡Œåªåˆ—å‡ºå¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>é€šè¿‡ Launcher å¯åŠ¨åº”ç”¨æ—¶ï¼Œç‚¹å‡»åº”ç”¨å›¾æ ‡åï¼ŒLauncher è°ƒç”¨ <code>startActivity()</code> å¯åŠ¨åº”ç”¨ã€‚</li>
<li>Launcher Activity æœ€ç»ˆè°ƒç”¨<code>Instrumentation</code> çš„ <code>execStartActivity</code> æ¥å¯åŠ¨åº”ç”¨ã€‚</li>
<li><code>Instrumentation</code> è°ƒç”¨ <code>ActivityManagerProxy</code> (<code>ActivityManagerService</code> åœ¨åº”ç”¨è¿›ç¨‹çš„ä¸€ä¸ªä»£ç†å¯¹è±¡) å¯¹è±¡çš„ <code>startActivity</code> æ–¹æ³•å¯åŠ¨ Activityã€‚</li>
<li>åˆ°ç›®å‰ä¸ºæ­¢æ‰€æœ‰è¿‡ç¨‹éƒ½åœ¨ Launcher è¿›ç¨‹é‡Œé¢æ‰§è¡Œï¼Œæ¥ä¸‹æ¥<code>ActivityManagerProxy</code> å¯¹è±¡è·¨è¿›ç¨‹è°ƒç”¨<code>ActivityManagerService</code> (è¿è¡Œåœ¨<strong><code>system_server</code> </strong>è¿›ç¨‹)çš„ <code>startActivity</code> æ–¹æ³•å¯åŠ¨åº”ç”¨ã€‚</li>
<li><code>ActivityManagerService</code> çš„ <code>startActivity</code> æ–¹æ³•ç»è¿‡ä¸€ç³»åˆ—è°ƒç”¨ï¼Œæœ€åè°ƒç”¨ <code>zygoteSendArgsAndGetResult</code> é€šè¿‡<code>socket</code> å‘é€ç»™ <code>zygote</code> è¿›ç¨‹ï¼Œ<code>zygote</code> è¿›ç¨‹ä¼šå­µåŒ–å‡ºæ–°çš„åº”ç”¨è¿›ç¨‹ã€‚</li>
<li><code>zygote</code> è¿›ç¨‹å­µåŒ–å‡ºæ–°çš„åº”ç”¨è¿›ç¨‹åï¼Œä¼šæ‰§è¡Œ<code>ActivityThread</code> ç±»çš„ <code>main()</code> æ–¹æ³•ã€‚åœ¨è¯¥æ–¹æ³•é‡Œä¼šå…ˆå‡†å¤‡å¥½ <code>Looper</code> å’Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œç„¶åè°ƒç”¨ <code>attach()</code> æ–¹æ³•å°†åº”ç”¨è¿›ç¨‹ç»‘å®šåˆ° <code>ActivityManagerService</code>ï¼Œç„¶åè¿›å…¥<code>loop</code> å¾ªç¯ï¼Œä¸æ–­åœ°è¯»å–æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„æ¶ˆæ¯ï¼Œå¹¶åˆ†å‘æ¶ˆæ¯ã€‚</li>
<li><code>ActivityManagerService</code> ä¿å­˜åº”ç”¨è¿›ç¨‹çš„ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œç„¶å <code>ActivityManagerService</code> é€šè¿‡ä»£ç†å¯¹è±¡é€šçŸ¥åº”ç”¨è¿›ç¨‹åˆ›å»ºå…¥å£ Activity çš„å®ä¾‹ï¼Œå¹¶æ‰§è¡Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚</li>
</ol>
<p><strong>æ€»ç»“è¿‡ç¨‹å°±æ˜¯ï¼š</strong>ç”¨æˆ·åœ¨ <code>Launcher</code> ç¨‹åºé‡Œç‚¹å‡»åº”ç”¨å›¾æ ‡æ—¶ï¼Œä¼šé€šçŸ¥ <code>ActivityManagerService</code> å¯åŠ¨åº”ç”¨çš„å…¥å£ Activityï¼Œ <code>ActivityManagerService</code> å‘ç°è¿™ä¸ªåº”ç”¨è¿˜æœªå¯åŠ¨ï¼Œåˆ™ä¼šé€šçŸ¥ <code>Zygote</code>è¿›ç¨‹å­µåŒ–å‡ºåº”ç”¨è¿›ç¨‹ï¼Œç„¶ååœ¨è¿™ä¸ªåº”ç”¨è¿›ç¨‹é‡Œæ‰§è¡Œ <code>ActivityThread</code> çš„ main() æ–¹æ³•ã€‚åº”ç”¨è¿›ç¨‹æ¥ä¸‹æ¥é€šçŸ¥<code>ActivityManagerService</code> åº”ç”¨è¿›ç¨‹å·²å¯åŠ¨ï¼Œ<code>ActivityManagerService</code> ä¿å­˜åº”ç”¨è¿›ç¨‹çš„ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œè¿™æ ·<code>ActivityManagerService</code> å¯ä»¥é€šè¿‡è¿™ä¸ªä»£ç†å¯¹è±¡æ§åˆ¶åº”ç”¨è¿›ç¨‹ï¼Œç„¶å ActivityManagerService é€šçŸ¥åº”ç”¨è¿›ç¨‹åˆ›å»ºå…¥å£ Activity çš„å®ä¾‹ï¼Œå¹¶æ‰§è¡Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚</p>
<p><strong>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å¤§æ¦‚ç†è§£ä¸€ä¸‹è¿™å‡ ä¸ªç›¸å…³ç±»çš„å®šä½</strong></p>
<p>ï¼ˆä¸€ï¼‰<strong>ActivityManagerService</strong>ï¼šï¼ˆActivityManagerNativeï¼‰æ˜¯æ ¸å¿ƒç®¡ç†ç±»ï¼Œè´Ÿè´£ç»„ä»¶çš„ç®¡ç†ï¼Œåœ¨è¿™é‡Œä¸»è¦ä¸ActivityStackSupervisoré€šä¿¡ã€‚</p>
<p>ï¼ˆäºŒï¼‰<strong>ActivityStackSupervisor</strong>ï¼šç®¡ç†æ•´ä¸ªæ‰‹æœºä»»åŠ¡æ ˆï¼Œå³ç®¡ç†ç€ActivityStackã€‚</p>
<p>ï¼ˆä¸‰ï¼‰<strong>ActivityStack</strong>ï¼šæ˜¯Activityçš„æ ˆï¼Œå³ä»»åŠ¡æ ˆï¼Œä»ä¸­å¯ä»¥è·å–éœ€è¦è¿›è¡Œæ“ä½œçš„ActivityRecordï¼Œå¹¶ä¸”å¯ä»¥å¯¹ä»»åŠ¡çš„è¿›ç¨‹è¿›è¡Œæ“ä½œã€‚</p>
<p>ï¼ˆå››ï¼‰<strong>ActivityThread</strong>ï¼šæ˜¯å®‰å“javaåº”ç”¨å±‚çš„å…¥å£å‡½æ•°ç±»ï¼Œå®ƒä¼šæ‰§è¡Œå…·ä½“å¯¹Activityçš„æ“ä½œï¼Œå¹¶å°†ç»“æœé€šçŸ¥ç»™ActivityManagerServiceã€‚</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul>
<li><a href="https://www.jianshu.com/p/2bed70245c76" target="_blank" rel="external">Activityå¯åŠ¨æµç¨‹ç®€ç›´ä¸§å¿ƒç—…ç‹‚ï¼</a></li>
<li><a href="http://blog.csdn.net/zhaokaiqiang1992/article/details/49428287" target="_blank" rel="external">ã€å‡¯å­å“¥å¸¦ä½ å­¦Frameworkã€‘Activityå¯åŠ¨è¿‡ç¨‹å…¨è§£æ</a></li>
<li><a href="http://blog.csdn.net/qq_23547831/article/details/51224992" target="_blank" rel="external">Androidæºç è§£æä¹‹ï¼ˆåå››ï¼‰â€“&gt;Activityå¯åŠ¨æµç¨‹</a></li>
<li><a href="http://www.cnblogs.com/solo-heart/articles/3871110.html" target="_blank" rel="external">å›¾è§£Activityå¯åŠ¨æµç¨‹</a></li>
<li><a href="https://www.jianshu.com/p/c967653a9468" target="_blank" rel="external">Android å¼€å‘ä¹‹ App å¯åŠ¨æ—¶é—´ç»Ÿè®¡</a></li>
<li><a href="https://juejin.im/post/5874bff0128fe1006b443fa0" target="_blank" rel="external">Androidæ€§èƒ½ä¼˜åŒ–ï¼ˆä¸€ï¼‰ä¹‹å¯åŠ¨åŠ é€Ÿ35%</a></li>
<li><a href="https://developer.android.com/topic/performance/launch-time.html" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£ - Launch-Time Performance</a></li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="../../../../categories/Android/">Android</a>

      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/Android/">Android</a></li></ul>

      
        <div id="donation_div"></div>

<script src="../../../../js/vdonate.js"></script>
<script>
var a = new Donate({
  title: 'å¦‚æœè§‰å¾—æˆ‘çš„æ–‡ç« å¯¹æ‚¨æœ‰ç”¨ï¼Œè¯·éšæ„æ‰“èµã€‚æ‚¨çš„æ”¯æŒå°†é¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œ!', // å¯é€‰å‚æ•°ï¼Œæ‰“èµæ ‡é¢˜
  btnText: 'æ‰“èµæ”¯æŒ', // å¯é€‰å‚æ•°ï¼Œæ‰“èµæŒ‰é’®æ–‡å­—
  el: document.getElementById('donation_div'),
  wechatImage: 'https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/site/source/about/donate/images/WeChanQR.png',
  alipayImage: 'https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/site/source/about/donate/images/AliPayQR.jpg'
});
</script>
      
            
      
        
	<div id="comment">
		<!-- æ¥å¿…åŠ›Cityç‰ˆå®‰è£…ä»£ç  -->
		<div id="lv-container" data-id="city" data-uid="MTAyMC8yOTQ4MS82MDQ5">
		<script type="text/javascript">
		   (function(d, s) {
		       var j, e = d.getElementsByTagName(s)[0];

		       if (typeof LivereTower === 'function') { return; }

		       j = d.createElement(s);
		       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
		       j.async = true;

		       e.parentNode.insertBefore(j, e);
		   })(document, 'script');
		</script>
		<noscript>ä¸ºæ­£å¸¸ä½¿ç”¨æ¥å¿…åŠ›è¯„è®ºåŠŸèƒ½è¯·æ¿€æ´»JavaScript</noscript>
		</div>
		<!-- Cityç‰ˆå®‰è£…ä»£ç å·²å®Œæˆ -->
	</div>


      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../../24/ã€ç®—æ³•ã€‘å¦‚ä½•åˆ¤æ–­é“¾è¡¨æœ‰ç¯/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">ä¸Šä¸€ç¯‡</strong>
      <div class="article-nav-title">
        
          ã€ç®—æ³•ã€‘å¦‚ä½•åˆ¤æ–­é“¾è¡¨æœ‰ç¯
        
      </div>
    </a>
  
  
    <a href="../../../11/25/ã€Javaã€‘HashMapæºç åˆ†æï¼ˆJDK1.8ï¼‰/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">ä¸‹ä¸€ç¯‡</strong>
      <div class="article-nav-title">ã€Javaã€‘HashMapæºç åˆ†æï¼ˆJDK1.8ï¼‰</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">æ–‡ç« ç›®å½•</strong>
    
      <ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#å¯åŠ¨Activityçš„æ–¹å¼"><span class="nav-number">1.</span> <span class="nav-text">å¯åŠ¨Activityçš„æ–¹å¼</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä»Activityå…¥æ‰‹"><span class="nav-number">2.</span> <span class="nav-text">ä»Activityå…¥æ‰‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ActivityManagerNativeæ˜¯ä»€ä¹ˆï¼Ÿ"><span class="nav-number">3.</span> <span class="nav-text">ActivityManagerNativeæ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ActivityManagerServiceï¼ˆAMSï¼‰"><span class="nav-number">4.</span> <span class="nav-text">ActivityManagerServiceï¼ˆAMSï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åˆè¿”å›ActivityStackSupervisorç±»"><span class="nav-number">5.</span> <span class="nav-text">åˆè¿”å›ActivityStackSupervisorç±»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#performLaunchActivity-æ–¹æ³•"><span class="nav-number">6.</span> <span class="nav-text">performLaunchActivity()æ–¹æ³•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#handleResumeActivity-æ–¹æ³•æµç¨‹"><span class="nav-number">7.</span> <span class="nav-text">handleResumeActivity()æ–¹æ³•æµç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åº”ç”¨çš„ä¸»è¦å¯åŠ¨æµç¨‹"><span class="nav-number">8.</span> <span class="nav-text">åº”ç”¨çš„ä¸»è¦å¯åŠ¨æµç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å‚è€ƒ"><span class="nav-number">9.</span> <span class="nav-text">å‚è€ƒ</span></a></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>
      <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2017 iTimeTraveler All Rights Reserved.
          
            <span id="busuanzi_container_site_uv">
              æœ¬ç«™è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>äººæ¬¡  
              æœ¬ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡
            </span>
          
      </div>
      <div class="site-credit">
        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hiero" target="_blank">hiero</a>
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var contentdiv = document.getElementById("content");

    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
</script>

<!-- Custome JS -->
<script src="../../../../js/my.js"></script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="../../../../index.html" class="mobile-nav-link">Home</a>
  
    <a href="../../../../archives" class="mobile-nav-link">Archives</a>
  
    <a href="../../../../categories" class="mobile-nav-link">Categories</a>
  
    <a href="../../../../tags" class="mobile-nav-link">Tags</a>
  
    <a href="../../../../funnysite" class="mobile-nav-link">é…·ç«™</a>
  
    <a href="../../../../collection" class="mobile-nav-link">æ”¶è—</a>
  
    <a href="../../../../about" class="mobile-nav-link">About</a>
  
    <a href="../../../../mybooks" class="mobile-nav-link">ğŸ</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="../../../../fancybox/jquery.fancybox.css">
  <script src="../../../../fancybox/jquery.fancybox.pack.js"></script>


<script src="../../../../js/scripts.js"></script>
<script src="../../../../js/bootstrap.js"></script>
<script src="../../../../js/main.js"></script>







  <div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
</body>
</html>
