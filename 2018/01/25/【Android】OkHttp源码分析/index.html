<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ã€androidã€‘okhttpæºç åˆ†æ | iTimeTraveler</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="OkHttp" />
  
  
  
  
  <meta name="description" content="Androidä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ç§HTTPäº¤äº’çš„æ–¹å¼ï¼šHttpURLConnection å’Œ Apache HttpClientï¼Œè™½ç„¶ä¸¤è€…éƒ½æ”¯æŒHTTPSï¼Œæµçš„ä¸Šä¼ å’Œä¸‹è½½ï¼Œé…ç½®è¶…æ—¶ï¼ŒIPv6å’Œè¿æ¥æ± ï¼Œå·²è¶³å¤Ÿæ»¡è¶³æˆ‘ä»¬å„ç§HTTPè¯·æ±‚çš„éœ€æ±‚ã€‚ä½†æ›´é«˜æ•ˆçš„ä½¿ç”¨HTTP å¯ä»¥è®©æ‚¨çš„åº”ç”¨è¿è¡Œæ›´å¿«ã€æ›´èŠ‚çœæµé‡ã€‚è€ŒOkHttpåº“å°±æ˜¯ä¸ºæ­¤è€Œç”Ÿã€‚åœ¨å¼€å§‹åˆ†æOkHttpä¹‹å‰æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ HttpURLConnection">
<meta name="keywords" content="OkHttp">
<meta property="og:type" content="article">
<meta property="og:title" content="ã€Androidã€‘OkHttpæºç åˆ†æ">
<meta property="og:url" content="http://github.com/2018/01/25/ã€Androidã€‘OkHttpæºç åˆ†æ/index.html">
<meta property="og:site_name" content="iTimeTraveler">
<meta property="og:description" content="Androidä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ç§HTTPäº¤äº’çš„æ–¹å¼ï¼šHttpURLConnection å’Œ Apache HttpClientï¼Œè™½ç„¶ä¸¤è€…éƒ½æ”¯æŒHTTPSï¼Œæµçš„ä¸Šä¼ å’Œä¸‹è½½ï¼Œé…ç½®è¶…æ—¶ï¼ŒIPv6å’Œè¿æ¥æ± ï¼Œå·²è¶³å¤Ÿæ»¡è¶³æˆ‘ä»¬å„ç§HTTPè¯·æ±‚çš„éœ€æ±‚ã€‚ä½†æ›´é«˜æ•ˆçš„ä½¿ç”¨HTTP å¯ä»¥è®©æ‚¨çš„åº”ç”¨è¿è¡Œæ›´å¿«ã€æ›´èŠ‚çœæµé‡ã€‚è€ŒOkHttpåº“å°±æ˜¯ä¸ºæ­¤è€Œç”Ÿã€‚åœ¨å¼€å§‹åˆ†æOkHttpä¹‹å‰æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ HttpURLConnection">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/master/gallery/android_common/okhttp_interceptors.png">
<meta property="og:updated_time" content="2018-01-26T08:04:43.264Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ã€Androidã€‘OkHttpæºç åˆ†æ">
<meta name="twitter:description" content="Androidä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ç§HTTPäº¤äº’çš„æ–¹å¼ï¼šHttpURLConnection å’Œ Apache HttpClientï¼Œè™½ç„¶ä¸¤è€…éƒ½æ”¯æŒHTTPSï¼Œæµçš„ä¸Šä¼ å’Œä¸‹è½½ï¼Œé…ç½®è¶…æ—¶ï¼ŒIPv6å’Œè¿æ¥æ± ï¼Œå·²è¶³å¤Ÿæ»¡è¶³æˆ‘ä»¬å„ç§HTTPè¯·æ±‚çš„éœ€æ±‚ã€‚ä½†æ›´é«˜æ•ˆçš„ä½¿ç”¨HTTP å¯ä»¥è®©æ‚¨çš„åº”ç”¨è¿è¡Œæ›´å¿«ã€æ›´èŠ‚çœæµé‡ã€‚è€ŒOkHttpåº“å°±æ˜¯ä¸ºæ­¤è€Œç”Ÿã€‚åœ¨å¼€å§‹åˆ†æOkHttpä¹‹å‰æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ HttpURLConnection">
<meta name="twitter:image" content="https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/master/gallery/android_common/okhttp_interceptors.png">
  
    <link rel="alternate" href="/atom.xml" title="iTimeTraveler" type="application/atom+xml">
  

  

  <link rel="icon" href="/gallery/avatar/0.svg">
  <link rel="apple-touch-icon" href="/gallery/avatar/0.svg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
  <link rel="stylesheet" href="../../../../css/style.css">

  <script src="../../../../js/jquery-3.1.1.min.js"></script>
  <script src="../../../../js/bootstrap.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >

  
    <link rel="stylesheet" href="../../../../css/dialog.css">
  

  

  
    <link rel="stylesheet" href="/css/header-post.css" >
  

  
  
  
    <link rel="stylesheet" href="/css/vdonate.css" >
  

</head>



  <body data-spy="scroll" data-target="#toc" data-offset="50">


  
  <div id="container">
    <div id="wrap">
      
        <header>

    <div id="allheader" class="navbar navbar-default navbar-static-top" role="navigation">
        <div class="navbar-inner">
          
          <div class="container"> 
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            
              <a class="brand" style="
                 border-width: 0px;  margin-top: 8px;"  
                href="#" data-toggle="modal" data-target="#myModal" >
                  <img width="75px" height="75px" alt="Hike News" src="/gallery/avatar/0.svg">
              </a>
            
            
            <div class="navbar-collapse collapse">
              <ul class="hnav navbar-nav">
                
                  <li> <a class="main-nav-link" href="../../../../index.html">é¦–é¡µ</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../archives">å½’æ¡£</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../categories">åˆ†ç±»</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../tags">æ ‡ç­¾</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../funnysite">é…·ç«™</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../collection">æ”¶è—</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../about">å…³äº</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../mybooks">ğŸ</a> </li>
                
                  <li><div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="è¯·è¾“å…¥å…³é”®è¯..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'æ–‡ç« ',
            PAGES: 'é¡µé¢',
            CATEGORIES: 'åˆ†ç±»',
            TAGS: 'æ ‡ç­¾',
            UNTITLED: '(æ— æ ‡é¢˜)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '../../../../content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="../../../../js/insight.js"></script>

</div></li>
            </div>
          </div>
                
      </div>
    </div>

</header>



      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-ã€Androidã€‘OkHttpæºç åˆ†æ" style="width: 75%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/master/gallery/android_common/okhttp_interceptors.png" rel="gallery_cjcvn6tcj003up0my3mbby61h">
        <img src="https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/master/gallery/android_common/okhttp_interceptors.png" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      ã€Androidã€‘OkHttpæºç åˆ†æ
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="" class="article-date">
	  <time datetime="2018-01-25T14:20:55.000Z" itemprop="datePublished">2018-01-25</time>
	</a>

      
    <a class="article-category-link" href="../../../../categories/Android/">Android</a><a class="article-category-link" href="../../../../categories/Android/æºç åˆ†æ/">æºç åˆ†æ</a>

      
	<a class="article-views">
	<span id="busuanzi_container_page_pv">
		é˜…è¯»é‡<span id="busuanzi_value_page_pv"></span>
	</span>
	</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>Androidä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ç§HTTPäº¤äº’çš„æ–¹å¼ï¼š<a href="https://developer.android.com/reference/java/net/HttpURLConnection.html" target="_blank" rel="noopener">HttpURLConnection</a> å’Œ Apache HttpClientï¼Œè™½ç„¶ä¸¤è€…éƒ½æ”¯æŒHTTPSï¼Œæµçš„ä¸Šä¼ å’Œä¸‹è½½ï¼Œé…ç½®è¶…æ—¶ï¼ŒIPv6å’Œè¿æ¥æ± ï¼Œå·²è¶³å¤Ÿæ»¡è¶³æˆ‘ä»¬å„ç§HTTPè¯·æ±‚çš„éœ€æ±‚ã€‚ä½†æ›´é«˜æ•ˆçš„ä½¿ç”¨HTTP å¯ä»¥è®©æ‚¨çš„åº”ç”¨è¿è¡Œæ›´å¿«ã€æ›´èŠ‚çœæµé‡ã€‚è€Œ<a href="https://github.com/square/okhttp">OkHttp</a>åº“å°±æ˜¯ä¸ºæ­¤è€Œç”Ÿã€‚åœ¨å¼€å§‹åˆ†æOkHttpä¹‹å‰æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ HttpURLConnection å’Œ HttpClient ä¸¤è€…ä¹‹é—´å…³ç³»ï¼Œä»¥åŠå®ƒä»¬å’Œ OkHttp ä¹‹é—´çš„å…³ç³»ã€‚</p>
<h2 id="HttpClient-vs-HttpURLConnection"><a href="#HttpClient-vs-HttpURLConnection" class="headerlink" title="HttpClient vs HttpURLConnection"></a>HttpClient vs HttpURLConnection</h2><p>åœ¨Android API Level 9ï¼ˆAndroid 2.2ï¼‰ä¹‹å‰ä¹‹èƒ½ä½¿ç”¨<code>DefaultHttpClient</code>ç±»å‘é€httpè¯·æ±‚ã€‚<code>DefaultHttpClient</code>æ˜¯Apacheç”¨äºå‘é€httpè¯·æ±‚çš„å®¢æˆ·ç«¯ï¼Œå…¶æä¾›äº†å¼ºå¤§çš„APIæ”¯æŒï¼Œè€Œä¸”åŸºæœ¬æ²¡æœ‰ä»€ä¹ˆbugï¼Œä½†æ˜¯ç”±äºå…¶å¤ªè¿‡å¤æ‚ï¼ŒAndroidå›¢é˜Ÿåœ¨ä¿æŒå‘åå…¼å®¹çš„æƒ…å†µä¸‹ï¼Œå¾ˆéš¾å¯¹<code>DefaultHttpClient</code>è¿›è¡Œå¢å¼ºã€‚ä¸ºæ­¤ï¼ŒAndroidå›¢é˜Ÿä»Android API Level 9å¼€å§‹è‡ªå·±å®ç°äº†ä¸€ä¸ªå‘é€httpè¯·æ±‚çš„å®¢æˆ·ç«¯ç±» â€”â€” <code>HttpURLConnection</code>ã€‚</p>
<p>ç›¸æ¯”äº<code>DefaultHttpClient</code>ï¼Œ<code>HttpURLConnection</code>æ¯”è¾ƒè½»é‡çº§ï¼Œè™½ç„¶åŠŸèƒ½æ²¡æœ‰<code>DefaultHttpClient</code>é‚£ä¹ˆå¼ºå¤§ï¼Œä½†æ˜¯èƒ½å¤Ÿæ»¡è¶³å¤§éƒ¨åˆ†çš„éœ€æ±‚ï¼Œæ‰€ä»¥Androidæ¨èä½¿ç”¨<code>HttpURLConnection</code>ä»£æ›¿<code>DefaultHttpClient</code>ï¼Œå¹¶ä¸å¼ºåˆ¶ä½¿ç”¨<code>HttpURLConnection</code>ã€‚</p>
<p>ä½†ä»Android API Level 23ï¼ˆAndroid 6.0ï¼‰å¼€å§‹ï¼Œä¸èƒ½å†åœ¨Androidä¸­ä½¿ç”¨<code>HttpClient</code>ï¼Œå¼ºåˆ¶ä½¿ç”¨<code>HttpURLConnection</code>ã€‚å‚è€ƒå®˜ç½‘ï¼š<a href="https://developer.android.com/about/versions/marshmallow/android-6.0-changes.html" target="_blank" rel="noopener">Android 6.0 Changes - Google Developer</a></p>
<blockquote>
<p>Android 6.0 ç‰ˆç§»é™¤äº†å¯¹ Apache HTTP clientçš„æ”¯æŒã€‚å¦‚æœæ‚¨çš„åº”ç”¨ä½¿ç”¨è¯¥å®¢æˆ·ç«¯ï¼Œå¹¶ä»¥ Android 2.3ï¼ˆAPI level 9ï¼‰æˆ–æ›´é«˜ç‰ˆæœ¬ä¸ºç›®æ ‡å¹³å°ï¼Œè¯·æ”¹ç”¨ <code>HttpURLConnection</code> ç±»ã€‚æ­¤ API æ•ˆç‡æ›´é«˜ï¼Œå› ä¸ºå®ƒå¯ä»¥é€šè¿‡é€æ˜å‹ç¼©å’Œå“åº”ç¼“å­˜å‡å°‘ç½‘ç»œä½¿ç”¨ï¼Œå¹¶å¯æœ€å¤§é™åº¦é™ä½è€—ç”µé‡ã€‚è¦ç»§ç»­ä½¿ç”¨ Apache HTTP APIï¼Œæ‚¨å¿…é¡»å…ˆåœ¨ <code>build.gradle</code> æ–‡ä»¶ä¸­å£°æ˜ä»¥ä¸‹ç¼–è¯‘æ—¶ä¾èµ–é¡¹ï¼š</p>
</blockquote>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    useLibrary <span class="string">'org.apache.http.legacy'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="äºŒè€…å¯¹æ¯”"><a href="#äºŒè€…å¯¹æ¯”" class="headerlink" title="äºŒè€…å¯¹æ¯”"></a>äºŒè€…å¯¹æ¯”</h3><ul>
<li><p><strong>HttpURLConnection</strong> </p>
<p>åœ¨Android2.2ä¹‹å‰ï¼šHttpURLConnection æœ‰ä¸ªé‡å¤§ Bugï¼šè°ƒç”¨ close() å‡½æ•°ä¼šå½±å“è¿æ¥æ± ,å¯¼è‡´è¿æ¥å¤ç”¨å¤±æ•ˆï¼›æ‰€ä»¥<strong>Android2.2ä¹‹å‰ä¸å»ºè®®ä½¿ç”¨HttpURLConnection</strong>ã€‚åœ¨Android2.2ä¹‹åï¼šHttpURLConnectioné»˜è®¤å¼€å¯äº† gzip å‹ç¼©&amp;æé«˜äº†HTTPS çš„æ€§èƒ½</p>
</li>
<li><p><strong>HttpClient</strong> </p>
<p>ä¼˜ç‚¹ï¼šç›¸æ¯”äºHttpURLConnectionï¼Œæ›´åŠ é«˜æ•ˆç®€æ´<br>ç¼ºç‚¹ï¼šç»“æ„è¿‡äºå¤æ‚ï¼›ç»´æŠ¤æˆæœ¬é«˜</p>
<blockquote>
<p>åœ¨5.0ç‰ˆæœ¬åè¢«Androidå®˜æ–¹å¼ƒç”¨</p>
</blockquote>
</li>
</ul>
<p>å°½ç®¡Googleåœ¨å¤§éƒ¨åˆ†å®‰å“ç‰ˆæœ¬ä¸­æ¨èä½¿ç”¨HttpURLConnectionï¼Œä½†æ˜¯è¿™ä¸ªç±»ç›¸æ¯”HttpClientå®åœ¨æ˜¯å¤ªéš¾ç”¨ï¼Œå¤ªå¼±çˆ†äº†ã€‚OkHttpæ˜¯ä¸€ä¸ªç›¸å¯¹æˆç†Ÿçš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬è·Ÿè¸ªè¿™ç¯‡æ–‡ç« ï¼š<a href="http://blog.csdn.net/charon_chui/article/details/46895773" target="_blank" rel="noopener">Android HttpURLConnectionæºç åˆ†æ</a>ã€‚å°±ä¼šå‘ç°Android4.4ä¹‹åçš„HttpURLConnectionåŸºäº<code>OkHttp</code>å®ç°çš„ã€‚æ‰€ä»¥æˆ‘ä»¬æ›´æœ‰ç†ç”±ç›¸ä¿¡OkHttpçš„å¼ºå¤§ã€‚</p>
<h3 id="äºŒè€…ä¸ç½‘ç»œè¯·æ±‚åº“ä¹‹é—´çš„å…³ç³»"><a href="#äºŒè€…ä¸ç½‘ç»œè¯·æ±‚åº“ä¹‹é—´çš„å…³ç³»" class="headerlink" title="äºŒè€…ä¸ç½‘ç»œè¯·æ±‚åº“ä¹‹é—´çš„å…³ç³»"></a>äºŒè€…ä¸ç½‘ç»œè¯·æ±‚åº“ä¹‹é—´çš„å…³ç³»</h3><p>ç½‘ç»œè¯·æ±‚æ¡†æ¶æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå°†ç½‘ç»œè¯·æ±‚çš„ç›¸å…³æ–¹æ³•ï¼ˆ HttpClientæˆ–HttpURLConnectionï¼‰å°è£…å¥½çš„ç±»åº“ï¼Œå¹¶å®ç°å¦å¼€çº¿ç¨‹è¿›è¡Œè¯·æ±‚å’Œå¤„ç†æ•°æ®ï¼Œä»è€Œå®ç°æ•´ä¸ªç½‘ç»œè¯·æ±‚æ¨¡å—çš„åŠŸèƒ½ã€‚å…·ä½“çš„å…³ç³»å¯çœ‹ä¸‹å›¾: </p>
<p><img src="https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/master/gallery/android_common/20160810152440105.jpg" alt=""></p>
<p>è€Œ<code>OkHttp</code>æ˜¯åŸºäºhttpåè®®å°è£…çš„ä¸€å¥—è¯·æ±‚å®¢æˆ·ç«¯ï¼Œè™½ç„¶å®ƒä¹Ÿå¯ä»¥å¼€çº¿ç¨‹ï¼Œä½†æ ¹æœ¬ä¸Šå®ƒæ›´åå‘çœŸæ­£çš„è¯·æ±‚ï¼Œè·Ÿ<code>HttpClient</code>ï¼Œ<code>HttpUrlConnection</code>çš„èŒè´£æ˜¯ä¸€æ ·çš„ã€‚</p>
<h2 id="OkHttpç®€ä»‹"><a href="#OkHttpç®€ä»‹" class="headerlink" title="OkHttpç®€ä»‹"></a>OkHttpç®€ä»‹</h2><p><a href="https://github.com/square/okhttp">OkHttp</a> åº“çš„è®¾è®¡å’Œå®ç°çš„é¦–è¦ç›®æ ‡æ˜¯é«˜æ•ˆã€‚è¿™ä¹Ÿæ˜¯é€‰æ‹© OkHttp çš„é‡è¦ç†ç”±ä¹‹ä¸€ã€‚OkHttp æä¾›äº†å¯¹æœ€æ–°çš„ HTTP åè®®ç‰ˆæœ¬ HTTP/2 å’Œ SPDY çš„æ”¯æŒï¼Œè¿™ä½¿å¾—å¯¹åŒä¸€ä¸ªä¸»æœºå‘å‡ºçš„æ‰€æœ‰è¯·æ±‚éƒ½å¯ä»¥å…±äº«ç›¸åŒçš„å¥—æ¥å­—è¿æ¥ã€‚å¦‚æœ HTTP/2 å’Œ SPDY ä¸å¯ç”¨ï¼ŒOkHttp ä¼šä½¿ç”¨è¿æ¥æ± æ¥å¤ç”¨è¿æ¥ä»¥æé«˜æ•ˆç‡ã€‚OkHttp æä¾›äº†å¯¹ GZIP çš„é»˜è®¤æ”¯æŒæ¥é™ä½ä¼ è¾“å†…å®¹çš„å¤§å°ã€‚OkHttp ä¹Ÿæä¾›äº†å¯¹ HTTP å“åº”çš„ç¼“å­˜æœºåˆ¶ï¼Œå¯ä»¥é¿å…ä¸å¿…è¦çš„ç½‘ç»œè¯·æ±‚ã€‚å½“ç½‘ç»œå‡ºç°é—®é¢˜æ—¶ï¼ŒOkHttp ä¼šè‡ªåŠ¨é‡è¯•ä¸€ä¸ªä¸»æœºçš„å¤šä¸ª IP åœ°å€ã€‚</p>
<p>OkHttpæ˜¯ä¸€ä¸ªé«˜æ•ˆçš„HTTPåº“:</p>
<blockquote>
<ul>
<li>æ”¯æŒ SPDY ï¼Œå…±äº«åŒä¸€ä¸ªSocketæ¥å¤„ç†åŒä¸€ä¸ªæœåŠ¡å™¨çš„æ‰€æœ‰è¯·æ±‚</li>
<li>å¦‚æœSPDYä¸å¯ç”¨ï¼Œåˆ™é€šè¿‡è¿æ¥æ± æ¥å‡å°‘è¯·æ±‚å»¶æ—¶</li>
<li>æ— ç¼çš„æ”¯æŒGZIPæ¥å‡å°‘æ•°æ®æµé‡</li>
<li>ç¼“å­˜å“åº”æ•°æ®æ¥å‡å°‘é‡å¤çš„ç½‘ç»œè¯·æ±‚</li>
</ul>
</blockquote>
<h2 id="å¦‚ä½•ä½¿ç”¨"><a href="#å¦‚ä½•ä½¿ç”¨" class="headerlink" title="å¦‚ä½•ä½¿ç”¨"></a>å¦‚ä½•ä½¿ç”¨</h2><p>OkHttpçš„ä½¿ç”¨æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œæ•´ä½“æ­¥éª¤æ˜¯ï¼š</p>
<ol>
<li>åˆå§‹åŒ–OkHttpClient</li>
<li>åˆå§‹åŒ–ä¸€ä¸ªRequest</li>
<li>ç”±OkHttpClientå’ŒRequestç”Ÿæˆä¸€ä¸ªCall</li>
<li>callè°ƒç”¨enqueueæˆ–è€…execute</li>
</ol>
<h3 id="åŒæ­¥Getè¯·æ±‚"><a href="#åŒæ­¥Getè¯·æ±‚" class="headerlink" title="åŒæ­¥Getè¯·æ±‚"></a>åŒæ­¥Getè¯·æ±‚</h3><p>è¿™æ˜¯OkHttp æœ€åŸºæœ¬çš„ HTTP è¯·æ±‚ï¼Œæ³¨æ„åˆ«æ”¾åˆ°UIçº¿ç¨‹æ‰§è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SyncGet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//1. åˆå§‹åŒ–OkHttpClient</span></span><br><span class="line">        OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. åˆå§‹åŒ–ä¸€ä¸ªRequest</span></span><br><span class="line">        Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">                .url(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line">                .header(<span class="string">"User-Agent"</span>, <span class="string">"My super agent"</span>)</span><br><span class="line">                .addHeader(<span class="string">"Accept"</span>, <span class="string">"text/html"</span>)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. ç”±OkHttpClientå’ŒRequestç”Ÿæˆä¸€ä¸ªCall</span></span><br><span class="line">        <span class="comment">//4. callè°ƒç”¨enqueueæˆ–è€…execute</span></span><br><span class="line">        Response response = client.newCall(request).execute();</span><br><span class="line">        <span class="keyword">if</span> (!response.isSuccessful()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"æœåŠ¡å™¨ç«¯é”™è¯¯: "</span> + response);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Headers responseHeaders = response.headers();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; responseHeaders.size(); i++) &#123;</span><br><span class="line">            System.out.println(responseHeaders.name(i) + <span class="string">": "</span> + responseHeaders.value(i));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(response.body().string());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å¼‚æ­¥Getè¯·æ±‚"><a href="#å¼‚æ­¥Getè¯·æ±‚" class="headerlink" title="å¼‚æ­¥Getè¯·æ±‚"></a>å¼‚æ­¥Getè¯·æ±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncGet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line"></span><br><span class="line">        Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">                .url(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        client.newCall(request).enqueue(<span class="keyword">new</span> Callback() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Request request, IOException e)</span> </span>&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (!response.isSuccessful()) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"æœåŠ¡å™¨ç«¯é”™è¯¯: "</span> + response);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                System.out.println(response.body().string());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Postè¯·æ±‚"><a href="#Postè¯·æ±‚" class="headerlink" title="Postè¯·æ±‚"></a>Postè¯·æ±‚</h3><p>HTTP POST å’Œ PUT è¯·æ±‚å¯ä»¥åŒ…å«è¦æäº¤çš„å†…å®¹ã€‚åªéœ€è¦åœ¨åˆ›å»º <code>Request</code> å¯¹è±¡æ—¶ï¼Œé€šè¿‡ <code>post()</code> å’Œ <code>put()</code> æ–¹æ³•æ¥æŒ‡å®šè¦æäº¤çš„å†…å®¹å³å¯ã€‚ä¸‹é¢çš„ä»£ç é€šè¿‡ <code>RequestBody</code> çš„ <code>create()</code> æ–¹æ³•æ¥åˆ›å»ºåª’ä½“ç±»å‹ä¸º<strong>application/ json</strong> çš„å†…å®¹å¹¶æäº¤ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> MediaType JSON = MediaType.parse(<span class="string">"application/json; charset=utf-8"</span>);</span><br><span class="line">OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line"></span><br><span class="line"><span class="comment">//postè¯·æ±‚</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">post</span><span class="params">(String url, String json)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    RequestBody body = RequestBody.create(JSON, json);</span><br><span class="line">    Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">            .url(url)</span><br><span class="line">            .post(body)</span><br><span class="line">            .build();</span><br><span class="line">    Response response = client.newCall(request).execute();</span><br><span class="line">    <span class="keyword">return</span> response.body().string();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…·ä½“çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒIBMçš„è¿™ç¯‡æ–‡ç« ï¼š<a href="https://www.ibm.com/developerworks/cn/java/j-lo-okhttp/" target="_blank" rel="noopener">OkHttpï¼šJavaå¹³å°ä¸Šçš„æ–°ä¸€ä»£HTTPå®¢æˆ·ç«¯</a> ï¼Œä¸‹é¢æˆ‘ä»¬è½¬å…¥æºç çš„åˆ†æã€‚</p>
<h2 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h2><p>æˆ‘ä»¬ä»åˆ›å»º <code>OkHttpClient</code> å¯¹è±¡å¼€å§‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</span><br></pre></td></tr></table></figure>
<h3 id="OkHttpClient"><a href="#OkHttpClient" class="headerlink" title="OkHttpClient"></a>OkHttpClient</h3><p>çœ‹çœ‹å…¶æ„é€ å‡½æ•°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">OkHttpClient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(<span class="keyword">new</span> Builder());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŸæ¥æ˜¯æ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨ï¼Œæä¾›äº†ä¸€ä¸ªâ€œå¿«æ·æ“ä½œâ€ï¼Œå…¨éƒ¨ä½¿ç”¨äº†é»˜è®¤çš„é…ç½®ã€‚<code>OkHttpClient.Builder</code> ç±»æˆå‘˜å¾ˆå¤šï¼Œåé¢æˆ‘ä»¬å†æ…¢æ…¢åˆ†æï¼Œè¿™é‡Œå…ˆæš‚æ—¶ç•¥è¿‡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//OkHttpClient.javaç±»ä¸­</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Builder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	dispatcher = <span class="keyword">new</span> Dispatcher();</span><br><span class="line">	protocols = DEFAULT_PROTOCOLS;</span><br><span class="line">	connectionSpecs = DEFAULT_CONNECTION_SPECS;</span><br><span class="line">	eventListenerFactory = EventListener.factory(EventListener.NONE);</span><br><span class="line">	proxySelector = ProxySelector.getDefault();</span><br><span class="line">	cookieJar = CookieJar.NO_COOKIES;</span><br><span class="line">	socketFactory = SocketFactory.getDefault();</span><br><span class="line">	hostnameVerifier = OkHostnameVerifier.INSTANCE;</span><br><span class="line">	certificatePinner = CertificatePinner.DEFAULT;</span><br><span class="line">	proxyAuthenticator = Authenticator.NONE;</span><br><span class="line">	authenticator = Authenticator.NONE;</span><br><span class="line">	connectionPool = <span class="keyword">new</span> ConnectionPool();</span><br><span class="line">	dns = Dns.SYSTEM;</span><br><span class="line">	followSslRedirects = <span class="keyword">true</span>;</span><br><span class="line">	followRedirects = <span class="keyword">true</span>;</span><br><span class="line">	retryOnConnectionFailure = <span class="keyword">true</span>;</span><br><span class="line">	connectTimeout = <span class="number">10_000</span>;</span><br><span class="line">	readTimeout = <span class="number">10_000</span>;</span><br><span class="line">	writeTimeout = <span class="number">10_000</span>;</span><br><span class="line">	pingInterval = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°è¿™ï¼Œå¦‚æœä½ è¿˜ä¸æ˜ç™½çš„è¯ï¼Œä¹Ÿæ²¡å…³ç³»ï¼Œåœ¨<code>OkHttp</code>ä¸­åªæ˜¯è®¾ç½®ç”¨çš„çš„å„ä¸ªä¸œè¥¿ã€‚çœŸæ­£çš„æµç¨‹è¦ä»é‡Œé¢çš„<code>newCall()</code>æ–¹æ³•ä¸­è¯´èµ·ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨OkHttpå‘èµ· HTTP è¯·æ±‚çš„æ–¹å¼ä¸€èˆ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">      .url(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line">      .build();</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‘èµ·è¯·æ±‚</span></span><br><span class="line">Response response = client.newCall(request).execute();</span><br></pre></td></tr></table></figure>
<p>å½“é€šè¿‡<strong>å»ºé€ è€…æ¨¡å¼</strong>åˆ›å»ºäº†<code>Request</code>ä¹‹åï¼ˆè¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è¯´ï¼‰ï¼Œç´§æ¥ç€å°±é€šè¿‡<code>client.newCall(request).execute()</code>æ¥è·å¾—<code>Response</code>ã€‚è¿™å¥ä»£ç å°±å¼€å¯äº†æ•´ä¸ªGETè¯·æ±‚çš„æµç¨‹ï¼š</p>
<p>é‚£æˆ‘ä»¬ç°åœ¨å°±æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•é€šè¿‡<code>newCall()</code>åˆ›å»º Call çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> Call <span class="title">newCall</span><span class="params">(Request request)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> RealCall.newRealCall(<span class="keyword">this</span>, request, <span class="keyword">false</span> <span class="comment">/* for web socket */</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>OkHttpClient</code> å®ç°äº† <code>Call.Factory</code>ï¼Œè´Ÿè´£æ ¹æ®è¯·æ±‚åˆ›å»ºæ–°çš„ <code>Call</code>ã€‚</p>
<blockquote>
<p><code>CallFactory</code> è´Ÿè´£åˆ›å»º HTTP è¯·æ±‚ï¼ŒHTTP è¯·æ±‚è¢«æŠ½è±¡ä¸ºäº† <code>okhttp3.Call</code> ç±»ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªå·²ç»å‡†å¤‡å¥½ï¼Œå¯ä»¥éšæ—¶æ‰§è¡Œçš„ HTTP è¯·æ±‚</p>
</blockquote>
<h3 id="RealCall"><a href="#RealCall" class="headerlink" title="RealCall"></a>RealCall</h3><p>å…ˆçœ‹çœ‹<code>newRealCall()</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> RealCall <span class="title">newRealCall</span><span class="params">(OkHttpClient client, Request originalRequest, <span class="keyword">boolean</span> forWebSocket)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// Safely publish the Call instance to the EventListener.</span></span><br><span class="line">	RealCall call = <span class="keyword">new</span> RealCall(client, originalRequest, forWebSocket);</span><br><span class="line">	call.eventListener = client.eventListenerFactory().create(call);</span><br><span class="line">	<span class="keyword">return</span> call;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">RealCall</span><span class="params">(OkHttpClient client, Request originalRequest, <span class="keyword">boolean</span> forWebSocket)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.client = client;</span><br><span class="line">	<span class="keyword">this</span>.originalRequest = originalRequest;</span><br><span class="line">	<span class="keyword">this</span>.forWebSocket = forWebSocket;</span><br><span class="line">	<span class="keyword">this</span>.retryAndFollowUpInterceptor = <span class="keyword">new</span> RetryAndFollowUpInterceptor(client, forWebSocket);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶å®å°±æ˜¯é€šè¿‡æ„é€ å‡½æ•°newäº†ä¸€ä¸ª<code>RealCall</code>å¯¹è±¡ï¼Œæ„é€ å‡½æ•°å¦‚ä¸‹ï¼Œä¸ç”¨çœ‹å¾ˆç»†ï¼Œç•¥è¿‡ã€‚æˆ‘ä»¬<strong>é‡ç‚¹çœ‹çœ‹ <code>RealCall#execute</code></strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//RealCallç±»ä¸­</span></span><br><span class="line"><span class="meta">@Override</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> Response <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">	<span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="comment">//1. æ¯ä¸ªCallåªèƒ½è¢«æ‰§è¡Œä¸€æ¬¡ã€‚å¦‚æœè¯¥ call å·²ç»è¢«æ‰§è¡Œè¿‡äº†ï¼Œå°±è®¾ç½® executed ä¸º true</span></span><br><span class="line">		<span class="keyword">if</span> (executed) <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Already Executed"</span>);</span><br><span class="line">		executed = <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	captureCallStackTrace();</span><br><span class="line">	eventListener.callStart(<span class="keyword">this</span>);</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//2. åŠ å…¥ runningSyncCalls é˜Ÿåˆ—ä¸­</span></span><br><span class="line">		client.dispatcher().executed(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">//3. å¾—åˆ°å“åº” result</span></span><br><span class="line">		Response result = getResponseWithInterceptorChain();</span><br><span class="line">		<span class="keyword">if</span> (result == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"Canceled"</span>);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">		eventListener.callFailed(<span class="keyword">this</span>, e);</span><br><span class="line">		<span class="keyword">throw</span> e;</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">//4. ä» runningSyncCalls é˜Ÿåˆ—ä¸­ç§»é™¤</span></span><br><span class="line">		client.dispatcher().finished(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬åšäº† 4 ä»¶äº‹ï¼š</p>
<ol>
<li>æ£€æŸ¥è¿™ä¸ª call æ˜¯å¦å·²ç»è¢«æ‰§è¡Œäº†ï¼Œæ¯ä¸ª call åªèƒ½è¢«æ‰§è¡Œä¸€æ¬¡ï¼Œå¦‚æœæƒ³è¦ä¸€ä¸ªå®Œå…¨ä¸€æ ·çš„ callï¼Œå¯ä»¥åˆ©ç”¨ <code>call#clone</code> æ–¹æ³•è¿›è¡Œå…‹éš†ã€‚</li>
<li>åˆ©ç”¨ <code>client.dispatcher().executed(this)</code> æ¥è¿›è¡Œå®é™…æ‰§è¡Œï¼Œ<code>dispatcher</code> æ˜¯åˆšæ‰çœ‹åˆ°çš„ <code>OkHttpClient.Builder</code> çš„æˆå‘˜ä¹‹ä¸€ï¼Œå®ƒçš„æ–‡æ¡£è¯´è‡ªå·±æ˜¯å¼‚æ­¥ HTTP è¯·æ±‚çš„æ‰§è¡Œç­–ç•¥ï¼Œç°åœ¨çœ‹æ¥ï¼ŒåŒæ­¥è¯·æ±‚å®ƒä¹Ÿæœ‰æºå’Œã€‚</li>
<li>è°ƒç”¨ <code>getResponseWithInterceptorChain()</code> å‡½æ•°è·å– HTTP è¿”å›ç»“æœï¼Œä»å‡½æ•°åå¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸€æ­¥è¿˜ä¼šè¿›è¡Œä¸€ç³»åˆ—â€œæ‹¦æˆªâ€æ“ä½œã€‚</li>
<li>æœ€åè¿˜è¦é€šçŸ¥ <code>dispatcher</code> è‡ªå·±å·²ç»æ‰§è¡Œå®Œæ¯•ã€‚</li>
</ol>
<p><code>dispatcher</code> è¿™é‡Œæˆ‘ä»¬ä¸è¿‡åº¦å…³æ³¨ï¼Œåœ¨åŒæ­¥æ‰§è¡Œçš„æµç¨‹ä¸­ï¼Œæ¶‰åŠåˆ° dispatcher çš„å†…å®¹åªä¸è¿‡æ˜¯å‘ŠçŸ¥å®ƒæˆ‘ä»¬çš„æ‰§è¡ŒçŠ¶æ€ï¼Œæ¯”å¦‚å¼€å§‹æ‰§è¡Œäº†ï¼ˆè°ƒç”¨ <code>executed</code>ï¼‰ï¼Œæ¯”å¦‚æ‰§è¡Œå®Œæ¯•äº†ï¼ˆè°ƒç”¨ <code>finished</code>ï¼‰ï¼Œåœ¨å¼‚æ­¥æ‰§è¡Œæµç¨‹ä¸­å®ƒä¼šæœ‰æ›´å¤šçš„å‚ä¸ã€‚</p>
<p>çœŸæ­£å‘å‡ºç½‘ç»œè¯·æ±‚ï¼Œè§£æè¿”å›ç»“æœçš„ï¼Œè¿˜æ˜¯ <code>getResponseWithInterceptorChain</code>ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™æ–¹æ³•æ˜¯ç›´æ¥è¿”å› <code>Response</code> å¯¹è±¡çš„ï¼Œæ‰€ä»¥ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ä¸€å®šåšäº†å¾ˆå¤šå¾ˆå¤šçš„äº‹æƒ…ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//RealCallç±»ä¸­</span></span><br><span class="line"><span class="function">Response <span class="title">getResponseWithInterceptorChain</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">// Build a full stack of interceptors.</span></span><br><span class="line">    List&lt;Interceptor&gt; interceptors = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    interceptors.addAll(client.interceptors());    <span class="comment">// åŠ å…¥ç”¨æˆ·è‡ªå®šä¹‰çš„æ‹¦æˆªå™¨</span></span><br><span class="line">    interceptors.add(retryAndFollowUpInterceptor);   <span class="comment">// é‡è¯•å’Œé‡å®šå‘æ‹¦æˆªå™¨</span></span><br><span class="line">    interceptors.add(<span class="keyword">new</span> BridgeInterceptor(client.cookieJar()));  <span class="comment">// åŠ å…¥è½¬åŒ–è¯·æ±‚å“åº”çš„æ‹¦æˆªå™¨</span></span><br><span class="line">    interceptors.add(<span class="keyword">new</span> CacheInterceptor(client.internalCache()));  <span class="comment">// åŠ å…¥ç¼“å­˜æ‹¦æˆªå™¨</span></span><br><span class="line">    interceptors.add(<span class="keyword">new</span> ConnectInterceptor(client));  <span class="comment">// åŠ å…¥è¿æ¥æ‹¦æˆªå™¨</span></span><br><span class="line">    <span class="keyword">if</span> (!forWebSocket) &#123;</span><br><span class="line">      interceptors.addAll(client.networkInterceptors());   <span class="comment">// åŠ å…¥ç”¨æˆ·è‡ªå®šä¹‰çš„ç½‘ç»œæ‹¦æˆªå™¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    interceptors.add(<span class="keyword">new</span> CallServerInterceptor(forWebSocket));   <span class="comment">// åŠ å…¥å‘å‡ºè¯·æ±‚å’Œè¯»å–å“åº”çš„æ‹¦æˆªå™¨</span></span><br><span class="line"></span><br><span class="line">    Interceptor.Chain chain = <span class="keyword">new</span> RealInterceptorChain(interceptors, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="number">0</span>,</span><br><span class="line">        originalRequest, <span class="keyword">this</span>, eventListener, client.connectTimeoutMillis(),</span><br><span class="line">        client.readTimeoutMillis(), client.writeTimeoutMillis());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ©ç”¨ chain æ¥é“¾å¼è°ƒç”¨æ‹¦æˆªå™¨ï¼Œæœ€åçš„è¿”å›ç»“æœå°±æ˜¯ Response å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">return</span> chain.proceed(originalRequest);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ <a href="https://publicobject.com/2016/07/03/the-last-httpurlconnection/" target="_blank" rel="noopener">OkHttp å¼€å‘è€…ä¹‹ä¸€ä»‹ç» OkHttp çš„æ–‡ç« </a>é‡Œé¢ï¼Œä½œè€…è®²åˆ°ï¼š</p>
<blockquote>
<p>the whole thing is just a stack of built-in interceptors.</p>
</blockquote>
<p>å¯è§ <code>Interceptor</code> æ˜¯ OkHttp æœ€æ ¸å¿ƒçš„ä¸€ä¸ªä¸œè¥¿ï¼Œä¸è¦è¯¯ä»¥ä¸ºå®ƒåªè´Ÿè´£æ‹¦æˆªè¯·æ±‚è¿›è¡Œä¸€äº›é¢å¤–çš„å¤„ç†ï¼ˆä¾‹å¦‚ cookieï¼‰ï¼Œ<strong>å®é™…ä¸Šå®ƒæŠŠå®é™…çš„ç½‘ç»œè¯·æ±‚ã€ç¼“å­˜ã€é€æ˜å‹ç¼©ç­‰åŠŸèƒ½éƒ½ç»Ÿä¸€äº†èµ·æ¥</strong>ï¼Œæ¯ä¸€ä¸ªåŠŸèƒ½éƒ½åªæ˜¯ä¸€ä¸ª <code>Interceptor</code>ï¼Œå®ƒä»¬å†è¿æ¥æˆä¸€ä¸ª <code>Interceptor.Chain</code>ï¼Œç¯ç¯ç›¸æ‰£ï¼Œæœ€ç»ˆåœ†æ»¡å®Œæˆä¸€æ¬¡ç½‘ç»œè¯·æ±‚ã€‚</p>
<p>ä» <code>getResponseWithInterceptorChain</code> å‡½æ•°æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>Interceptor.Chain</code> çš„åˆ†å¸ƒä¾æ¬¡æ˜¯ï¼š</p>
<p><img src="https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/master/gallery/android_common/okhttp_interceptors-details.png" alt=""></p>
<ol>
<li><code>client.interceptors()</code> ï¼Œé¦–å…ˆåŠ å…¥ <code>interceptors</code> çš„æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„æ‹¦æˆªå™¨ï¼Œæ¯”å¦‚ä¿®æ”¹è¯·æ±‚å¤´çš„æ‹¦æˆªå™¨ç­‰ï¼›</li>
<li><strong>RetryAndFollowUpInterceptor</strong> ï¼šæ˜¯ç”¨æ¥é‡è¯•å’Œé‡å®šå‘çš„æ‹¦æˆªå™¨ï¼Œåœ¨ä¸‹é¢æˆ‘ä»¬ä¼šè®²åˆ°ï¼›</li>
<li><strong>BridgeInterceptor</strong>ï¼šæ˜¯ç”¨æ¥å°†ç”¨æˆ·å‹å¥½çš„è¯·æ±‚è½¬åŒ–ä¸ºå‘æœåŠ¡å™¨çš„è¯·æ±‚ï¼Œä¹‹ååˆæŠŠæœåŠ¡å™¨çš„å“åº”è½¬åŒ–ä¸ºå¯¹ç”¨æˆ·å‹å¥½çš„å“åº”ï¼›</li>
<li><strong>CacheInterceptor</strong>ï¼šæ˜¯ç¼“å­˜æ‹¦æˆªå™¨ï¼Œè‹¥å­˜åœ¨ç¼“å­˜å¹¶ä¸”å¯ç”¨å°±ç›´æ¥è¿”å›è¯¥ç¼“å­˜ï¼Œå¦åˆ™ä¼šå‘æœåŠ¡å™¨è¯·æ±‚ï¼›</li>
<li><strong>ConnectInterceptor</strong>ï¼šç”¨æ¥å»ºç«‹è¿æ¥çš„æ‹¦æˆªå™¨ï¼›</li>
<li><code>client.networkInterceptors()</code> åŠ å…¥ç”¨æˆ·è‡ªå®šä¹‰çš„ <code>networkInterceptors</code> ;</li>
<li><strong>CallServerInterceptor</strong>ï¼šæ˜¯çœŸæ­£å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ä¸”å¾—åˆ°å“åº”çš„æ‹¦æˆªå™¨ï¼›</li>
</ol>
<p>åœ¨è¿™é‡Œï¼Œä½ç½®å†³å®šäº†åŠŸèƒ½ï¼Œæœ€åä¸€ä¸ª Interceptor ä¸€å®šæ˜¯è´Ÿè´£å’ŒæœåŠ¡å™¨å®é™…é€šè®¯çš„ï¼Œé‡å®šå‘ã€ç¼“å­˜ç­‰ä¸€å®šæ˜¯åœ¨å®é™…é€šè®¯ä¹‹å‰çš„ã€‚</p>
<p><a href="https://zh.wikipedia.org/wiki/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F" target="_blank" rel="noopener">è´£ä»»é“¾æ¨¡å¼</a>åœ¨è¿™ä¸ª <code>Interceptor</code> é“¾æ¡ä¸­å¾—åˆ°äº†å¾ˆå¥½çš„å®è·µã€‚</p>
<blockquote>
<p><strong>è´£ä»»é“¾æ¨¡å¼</strong>åœ¨<a href="https://zh.wikipedia.org/wiki/%E7%89%A9%E4%BB%B6%E5%B0%8E%E5%90%91%E7%A8%8B%E5%BC%8F%E8%A8%AD%E8%A8%88" target="_blank" rel="noopener">é¢å‘å¯¹è±¡ç¨‹å¼è®¾è®¡</a>é‡Œæ˜¯ä¸€ç§<a href="https://zh.wikipedia.org/wiki/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F" target="_blank" rel="noopener">è½¯ä»¶è®¾è®¡æ¨¡å¼</a>ï¼Œå®ƒåŒ…å«äº†ä¸€äº›å‘½ä»¤å¯¹è±¡å’Œä¸€ç³»åˆ—çš„å¤„ç†å¯¹è±¡ã€‚æ¯ä¸€ä¸ªå¤„ç†å¯¹è±¡å†³å®šå®ƒèƒ½å¤„ç†å“ªäº›å‘½ä»¤å¯¹è±¡ï¼Œå®ƒä¹ŸçŸ¥é“å¦‚ä½•å°†å®ƒä¸èƒ½å¤„ç†çš„å‘½ä»¤å¯¹è±¡ä¼ é€’ç»™è¯¥é“¾ä¸­çš„ä¸‹ä¸€ä¸ªå¤„ç†å¯¹è±¡ã€‚è¯¥æ¨¡å¼è¿˜æè¿°äº†å¾€è¯¥å¤„ç†é“¾çš„æœ«å°¾æ·»åŠ æ–°çš„å¤„ç†å¯¹è±¡çš„æ–¹æ³•ã€‚</p>
</blockquote>
<p>å¦å¤–å‚è€ƒæ–‡ç« ï¼š<a href="https://github.com/simple-android-framework-exchange/android_design_patterns_analysis/tree/master/chain-of-responsibility/AigeStudio#android%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E6%A8%A1%E5%BC%8F%E5%AE%9E%E7%8E%B0">Androidè®¾è®¡æ¨¡å¼ä¹‹è´£ä»»é“¾æ¨¡å¼</a>ä¸­ç›¸å…³çš„åˆ†æï¼š</p>
<blockquote>
<p>Androidä¸­å…³äºè´£ä»»é“¾æ¨¡å¼æ¯”è¾ƒæ˜æ˜¾çš„ä½“ç°å°±æ˜¯åœ¨äº‹ä»¶åˆ†å‘è¿‡ç¨‹ä¸­å¯¹äº‹ä»¶çš„æŠ•é€’ï¼Œå…¶å®ä¸¥æ ¼æ¥è¯´ï¼Œäº‹ä»¶æŠ•é€’çš„æ¨¡å¼å¹¶ä¸æ˜¯ä¸¥æ ¼çš„è´£ä»»é“¾æ¨¡å¼ï¼Œä½†æ˜¯å…¶æ˜¯è´£ä»»é“¾æ¨¡å¼çš„ä¸€ç§å˜ç§ä½“ç°ã€‚</p>
</blockquote>
<p>å¯¹äºæŠŠ <code>Request</code> å˜æˆ <code>Response</code> è¿™ä»¶äº‹æ¥è¯´ï¼Œæ¯ä¸ª <code>Interceptor</code> éƒ½å¯èƒ½å®Œæˆè¿™ä»¶äº‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾ªç€é“¾æ¡è®©æ¯ä¸ª <code>Interceptor</code> è‡ªè¡Œå†³å®šèƒ½å¦å®Œæˆä»»åŠ¡ä»¥åŠæ€ä¹ˆå®Œæˆä»»åŠ¡ï¼ˆè‡ªåŠ›æ›´ç”Ÿæˆ–è€…äº¤ç»™ä¸‹ä¸€ä¸ª <code>Interceptor</code>ï¼‰ã€‚è¿™æ ·ä¸€æ¥ï¼Œå®Œæˆç½‘ç»œè¯·æ±‚è¿™ä»¶äº‹å°±å½»åº•ä» <code>RealCall</code> ç±»ä¸­å‰¥ç¦»äº†å‡ºæ¥ï¼Œç®€åŒ–äº†å„è‡ªçš„è´£ä»»å’Œé€»è¾‘ã€‚</p>
<h2 id="æ‹¦æˆªå™¨"><a href="#æ‹¦æˆªå™¨" class="headerlink" title="æ‹¦æˆªå™¨"></a>æ‹¦æˆªå™¨</h2><p>æ‹¦æˆªå™¨æ˜¯ OkHttp æä¾›çš„å¯¹ HTTP è¯·æ±‚å’Œå“åº”è¿›è¡Œç»Ÿä¸€å¤„ç†çš„å¼ºå¤§æœºåˆ¶ã€‚æ‹¦æˆªå™¨åœ¨å®ç°å’Œä½¿ç”¨ä¸Šç±»ä¼¼äº Servlet è§„èŒƒä¸­çš„è¿‡æ»¤å™¨ã€‚å¤šä¸ªæ‹¦æˆªå™¨å¯ä»¥é“¾æ¥èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªé“¾æ¡ã€‚æ‹¦æˆªå™¨ä¼šæŒ‰ç…§åœ¨é“¾æ¡ä¸Šçš„é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚ æ‹¦æˆªå™¨åœ¨æ‰§è¡Œæ—¶ï¼Œå¯ä»¥å…ˆå¯¹è¯·æ±‚çš„ Request å¯¹è±¡è¿›è¡Œä¿®æ”¹ï¼›å†å¾—åˆ°å“åº”çš„ Response å¯¹è±¡ä¹‹åï¼Œå¯ä»¥è¿›è¡Œä¿®æ”¹ä¹‹åå†è¿”å›ã€‚</p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>OkHttp ä½œä¸ºä¸€ä¸ªç®€æ´é«˜æ•ˆçš„ HTTP å®¢æˆ·ç«¯ï¼Œå¯ä»¥åœ¨ Java å’Œ Android ç¨‹åºä¸­ä½¿ç”¨ã€‚ç›¸å¯¹äº Apache HttpClient æ¥è¯´ï¼ŒOkHttp çš„æ€§èƒ½æ›´å¥½ï¼Œå…¶ API è®¾è®¡ä¹Ÿæ›´åŠ ç®€å•å®ç”¨ã€‚</p>
<p>OkHttp ä½¿ç”¨è°ƒç”¨ï¼ˆCallï¼‰æ¥å¯¹å‘é€ HTTP è¯·æ±‚å’Œè·å–å“åº”çš„è¿‡ç¨‹è¿›è¡ŒæŠ½è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Call</span> <span class="keyword">extends</span> <span class="title">Cloneable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function">Request <span class="title">request</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">Response <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">enqueue</span><span class="params">(Callback responseCallback)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">cancel</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">isExecuted</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">isCanceled</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">Call <span class="title">clone</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">interface</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">		<span class="function">Call <span class="title">newCall</span><span class="params">(Request request)</span></span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="HTTP-è¿æ¥"><a href="#HTTP-è¿æ¥" class="headerlink" title="HTTP è¿æ¥"></a>HTTP è¿æ¥</h2><p>è™½ç„¶åœ¨ä½¿ç”¨ OkHttp å‘é€ HTTP è¯·æ±‚æ—¶åªéœ€è¦æä¾› URL å³å¯ï¼ŒOkHttp åœ¨å®ç°ä¸­éœ€è¦ç»¼åˆè€ƒè™‘ 3 ç§ä¸åŒçš„è¦ç´ æ¥ç¡®å®šä¸ HTTP æœåŠ¡å™¨ä¹‹é—´å®é™…å»ºç«‹çš„ HTTP è¿æ¥ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†è¾¾åˆ°æœ€ä½³çš„æ€§èƒ½ã€‚</p>
<p>é¦–å…ˆç¬¬ä¸€ä¸ªè€ƒè™‘çš„è¦ç´ æ˜¯ URL æœ¬èº«ã€‚URL ç»™å‡ºäº†è¦è®¿é—®çš„èµ„æºçš„è·¯å¾„ã€‚æ¯”å¦‚ URL <a href="http://www.baidu.com" target="_blank" rel="noopener">http://www.baidu.com</a> æ‰€å¯¹åº”çš„æ˜¯ç™¾åº¦é¦–é¡µçš„ HTTP æ–‡æ¡£ã€‚åœ¨ URL ä¸­æ¯”è¾ƒé‡è¦çš„éƒ¨åˆ†æ˜¯è®¿é—®æ—¶ä½¿ç”¨çš„æ¨¡å¼ï¼Œå³ HTTP è¿˜æ˜¯ HTTPSã€‚è¿™ä¼šç¡®å®š OkHttp æ‰€å»ºç«‹çš„æ˜¯æ˜æ–‡çš„ HTTP è¿æ¥ï¼Œè¿˜æ˜¯åŠ å¯†çš„ HTTPS è¿æ¥ã€‚</p>
<p>ç¬¬äºŒä¸ªè¦ç´ æ˜¯ HTTP æœåŠ¡å™¨çš„åœ°å€ï¼Œå¦‚ baidu.comã€‚æ¯ä¸ªåœ°å€éƒ½æœ‰å¯¹åº”çš„é…ç½®ï¼ŒåŒ…æ‹¬ç«¯å£å·ï¼ŒHTTPS è¿æ¥è®¾ç½®å’Œç½‘ç»œä¼ è¾“åè®®ã€‚åŒä¸€ä¸ªåœ°å€ä¸Šçš„ URL å¯ä»¥å…±äº«åŒä¸€ä¸ªåº•å±‚ TCP å¥—æ¥å­—è¿æ¥ã€‚é€šè¿‡å…±äº«è¿æ¥å¯ä»¥æœ‰æ˜¾è‘—çš„æ€§èƒ½æå‡ã€‚OkHttp æä¾›äº†ä¸€ä¸ªè¿æ¥æ± æ¥å¤ç”¨è¿æ¥ã€‚</p>
<p>ç¬¬ä¸‰ä¸ªè¦ç´ æ˜¯è¿æ¥ HTTP æœåŠ¡å™¨æ—¶ä½¿ç”¨çš„è·¯ç”±ã€‚è·¯ç”±åŒ…æ‹¬å…·ä½“è¿æ¥çš„ IP åœ°å€ï¼ˆé€šè¿‡ DNS æŸ¥è¯¢æ¥å‘ç°ï¼‰å’Œæ‰€ä½¿ç”¨çš„ä»£ç†æœåŠ¡å™¨ã€‚å¯¹äº HTTPS è¿æ¥è¿˜åŒ…æ‹¬é€šè®¯åå•†æ—¶ä½¿ç”¨çš„ TLS ç‰ˆæœ¬ã€‚å¯¹äºåŒä¸€ä¸ªåœ°å€ï¼Œå¯èƒ½æœ‰å¤šä¸ªä¸åŒçš„è·¯ç”±ã€‚OkHttp åœ¨é‡åˆ°è®¿é—®é”™è¯¯æ—¶ä¼šè‡ªåŠ¨å°è¯•å¤‡é€‰è·¯ç”±ã€‚</p>
<p>å½“é€šè¿‡ OkHttp æ¥è¯·æ±‚æŸä¸ª URL æ—¶ï¼ŒOkHttp é¦–å…ˆä» URL ä¸­å¾—åˆ°åœ°å€ä¿¡æ¯ï¼Œå†ä»è¿æ¥æ± ä¸­æ ¹æ®åœ°å€æ¥è·å–è¿æ¥ã€‚å¦‚æœåœ¨è¿æ¥æ± ä¸­æ²¡æœ‰æ‰¾åˆ°è¿æ¥ï¼Œåˆ™é€‰æ‹©ä¸€ä¸ªè·¯ç”±æ¥å°è¯•è¿æ¥ã€‚å°è¯•è¿æ¥éœ€è¦é€šè¿‡ DNS æŸ¥è¯¢æ¥å¾—åˆ°æœåŠ¡å™¨çš„ IP åœ°å€ï¼Œä¹Ÿä¼šç”¨åˆ°ä»£ç†æœåŠ¡å™¨å’Œ TLS ç‰ˆæœ¬ç­‰ä¿¡æ¯ã€‚å½“å®é™…çš„è¿æ¥å»ºç«‹ä¹‹åï¼ŒOkHttp å‘é€ HTTP è¯·æ±‚å¹¶è·å–å“åº”ã€‚å½“è¿æ¥å‡ºç°é—®é¢˜æ—¶ï¼ŒOkHttp ä¼šè‡ªåŠ¨é€‰æ‹©å¦å¤–çš„è·¯ç”±è¿›è¡Œå°è¯•ã€‚è¿™ä½¿å¾— OkHttp å¯ä»¥è‡ªåŠ¨å¤„ç†å¯èƒ½å‡ºç°çš„ç½‘ç»œé—®é¢˜ã€‚å½“æˆåŠŸè·å–åˆ° HTTP è¯·æ±‚çš„å“åº”ä¹‹åï¼Œå½“å‰çš„è¿æ¥ä¼šè¢«æ”¾å›åˆ°è¿æ¥æ± ä¸­ï¼Œæä¾›ç»™åç»­çš„è¯·æ±‚æ¥å¤ç”¨ã€‚è¿æ¥æ± ä¼šå®šæœŸæŠŠé—²ç½®çš„è¿æ¥å…³é—­ä»¥é‡Šæ”¾èµ„æºã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a href="http://blog.csdn.net/a109340/article/details/73887753" target="_blank" rel="noopener">OkHttpçš„åˆå§‹åŒ–</a></li>
<li><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0326/2643.html" target="_blank" rel="noopener">OKHttpæºç è§£æ</a></li>
<li><a href="https://juejin.im/entry/597800116fb9a06baf2eeb63" target="_blank" rel="noopener">OkHttpæºç è§£æ</a> - <a href="https://link.juejin.im/?target=http%3A%2F%2Fyuqirong.me%2F2017%2F07%2F25%2FOkHttp%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%2F" target="_blank" rel="noopener">yuqirong.me</a></li>
<li><a href="https://blog.piasy.com/2016/07/11/Understand-OkHttp/" target="_blank" rel="noopener">æ‹†è½®å­ç³»åˆ—ï¼šæ‹†OkHttp</a></li>
<li><a href="https://www.ibm.com/developerworks/cn/java/j-lo-okhttp/" target="_blank" rel="noopener">OkHttpï¼šJava å¹³å°ä¸Šçš„æ–°ä¸€ä»£ HTTP å®¢æˆ·ç«¯ - IBM DeveloperWorks</a></li>
<li><a href="http://blog.csdn.net/carson_ho/article/details/52171976" target="_blank" rel="noopener">Androidä¸»æµç½‘ç»œè¯·æ±‚å¼€æºåº“çš„å¯¹æ¯”ï¼ˆAndroid-Async-Httpã€Volleyã€OkHttpã€Retrofitï¼‰</a></li>
<li><a href="https://www.jianshu.com/p/77d418e7b5d6" target="_blank" rel="noopener">OkHttp, Retrofit, Volleyåº”è¯¥é€‰æ‹©å“ªä¸€ä¸ªï¼Ÿ</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      
        <div id="donation_div"></div>

<script src="../../../../js/vdonate.js"></script>
<script>
var a = new Donate({
  title: 'å¦‚æœè§‰å¾—æˆ‘çš„æ–‡ç« å¯¹æ‚¨æœ‰ç”¨ï¼Œè¯·éšæ„æ‰“èµã€‚æ‚¨çš„æ”¯æŒå°†é¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œ!', // å¯é€‰å‚æ•°ï¼Œæ‰“èµæ ‡é¢˜
  btnText: 'æ‰“èµæ”¯æŒ', // å¯é€‰å‚æ•°ï¼Œæ‰“èµæŒ‰é’®æ–‡å­—
  el: document.getElementById('donation_div'),
  wechatImage: 'https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/site/source/about/donate/images/WeChanQR.png',
  alipayImage: 'https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/site/source/about/donate/images/AliPayQR.jpg'
});
</script>
      
      
        
	<div id="comment">
		<!-- æ¥å¿…åŠ›Cityç‰ˆå®‰è£…ä»£ç  -->
		<div id="lv-container" data-id="city" data-uid="MTAyMC8yOTQ4MS82MDQ5">
		<script type="text/javascript">
		   (function(d, s) {
		       var j, e = d.getElementsByTagName(s)[0];

		       if (typeof LivereTower === 'function') { return; }

		       j = d.createElement(s);
		       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
		       j.async = true;

		       e.parentNode.insertBefore(j, e);
		   })(document, 'script');
		</script>
		<noscript>ä¸ºæ­£å¸¸ä½¿ç”¨æ¥å¿…åŠ›è¯„è®ºåŠŸèƒ½è¯·æ¿€æ´»JavaScript</noscript>
		</div>
		<!-- Cityç‰ˆå®‰è£…ä»£ç å·²å®Œæˆ -->
	</div>



      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/æºç åˆ†æ/">æºç åˆ†æ</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="../../22/ç”¨Javaå®ç°æ–­ç‚¹ç»­ä¼  (HTTP)/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">ä¸‹ä¸€ç¯‡</strong>
      <div class="article-nav-title">ç”¨Javaå®ç°æ–­ç‚¹ç»­ä¼  (HTTP)</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="toc-sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">æ–‡ç« ç›®å½•</strong>
    
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#HttpClient-vs-HttpURLConnection"><span class="nav-number">1.</span> <span class="nav-text">HttpClient vs HttpURLConnection</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#äºŒè€…å¯¹æ¯”"><span class="nav-number">1.1.</span> <span class="nav-text">äºŒè€…å¯¹æ¯”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#äºŒè€…ä¸ç½‘ç»œè¯·æ±‚åº“ä¹‹é—´çš„å…³ç³»"><span class="nav-number">1.2.</span> <span class="nav-text">äºŒè€…ä¸ç½‘ç»œè¯·æ±‚åº“ä¹‹é—´çš„å…³ç³»</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OkHttpç®€ä»‹"><span class="nav-number">2.</span> <span class="nav-text">OkHttpç®€ä»‹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å¦‚ä½•ä½¿ç”¨"><span class="nav-number">3.</span> <span class="nav-text">å¦‚ä½•ä½¿ç”¨</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#åŒæ­¥Getè¯·æ±‚"><span class="nav-number">3.1.</span> <span class="nav-text">åŒæ­¥Getè¯·æ±‚</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å¼‚æ­¥Getè¯·æ±‚"><span class="nav-number">3.2.</span> <span class="nav-text">å¼‚æ­¥Getè¯·æ±‚</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Postè¯·æ±‚"><span class="nav-number">3.3.</span> <span class="nav-text">Postè¯·æ±‚</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æºç åˆ†æ"><span class="nav-number">4.</span> <span class="nav-text">æºç åˆ†æ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#OkHttpClient"><span class="nav-number">4.1.</span> <span class="nav-text">OkHttpClient</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RealCall"><span class="nav-number">4.2.</span> <span class="nav-text">RealCall</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ‹¦æˆªå™¨"><span class="nav-number">5.</span> <span class="nav-text">æ‹¦æˆªå™¨</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å°ç»“"><span class="nav-number">6.</span> <span class="nav-text">å°ç»“</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HTTP-è¿æ¥"><span class="nav-number">7.</span> <span class="nav-text">HTTP è¿æ¥</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å‚è€ƒèµ„æ–™"><span class="nav-number">8.</span> <span class="nav-text">å‚è€ƒèµ„æ–™</span></a></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2013 - 2018 iTimeTraveler All Rights Reserved.</p>
	      
	      
    		<p class="busuanzi_uv">
				è®¿å®¢æ•° : <span id="busuanzi_value_site_uv"></span> |  
				è®¿é—®é‡ : <span id="busuanzi_value_site_pv"></span>
		    </p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="../../../../index.html" class="mobile-nav-link">Home</a>
  
    <a href="../../../../archives" class="mobile-nav-link">Archives</a>
  
    <a href="../../../../categories" class="mobile-nav-link">Categories</a>
  
    <a href="../../../../tags" class="mobile-nav-link">Tags</a>
  
    <a href="../../../../funnysite" class="mobile-nav-link">é…·ç«™</a>
  
    <a href="../../../../collection" class="mobile-nav-link">æ”¶è—</a>
  
    <a href="../../../../about" class="mobile-nav-link">About</a>
  
    <a href="../../../../mybooks" class="mobile-nav-link">ğŸ</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="../../../../fancybox/jquery.fancybox.css">
  <script src="../../../../fancybox/jquery.fancybox.pack.js"></script>


<script src="../../../../js/scripts.js"></script>




  <script src="../../../../js/dialog.js"></script>








	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">è®¾ç½®</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              æ­£æ–‡å­—å·å¤§å°
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            æ‚¨å·²è°ƒæ•´é¡µé¢å­—ä½“å¤§å°
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              å¤œé—´æŠ¤çœ¼æ¨¡å¼
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            å¤œé—´æ¨¡å¼å·²ç»å¼€å¯ï¼Œå†æ¬¡å•å‡»æŒ‰é’®å³å¯å…³é—­ 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å…³ äº&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            iTimeTraveler
          </div>
          <div class="panel-body">
            Copyright Â© 2018 Mr.Seven All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
    <a id="menu-switch"><i class="fa fa-bars fa-lg"></i></a>
  
</body>
</html>